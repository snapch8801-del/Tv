<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù„ÙˆØ­Ø© ØªØ³ÙŠÙŠØ± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª - v11.5</title>

<style>
:root{
  --bg0:#070a12; --bg1:#0b1020; --card: rgba(255,255,255,.06); --line: rgba(255,255,255,.10);
  --text:#eaf0ff; --muted: rgba(234,240,255,.70); --accent:#7c5cff; --warn:#f59e0b;
  --err:#ef4444; --radius:18px; --shadow: 0 18px 45px rgba(0,0,0,.45);
}

*{box-sizing:border-box}
body{
  margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; color: var(--text);
  background: radial-gradient(1200px 650px at 85% -10%, rgba(124,92,255,.25), transparent 60%), linear-gradient(180deg, var(--bg0), var(--bg1));
  padding: 18px;
}
.container{max-width:1200px;margin:0 auto}

.header{margin-bottom:14px}
.header h1{margin:0;font-size:20px; display: flex; align-items: center; gap: 8px;}
.header .sub{margin-top:6px;font-size:13px;color:var(--muted);line-height:1.7}
.version-badge { background: linear-gradient(135deg, var(--accent), #5a3bc2); color: white; padding: 4px 8px; border-radius: 8px; font-weight: 900; font-size: 12px; box-shadow: 0 4px 15px rgba(124,92,255,0.3);}

.card{ background: var(--card); border: 1px solid var(--line); border-radius: var(--radius); box-shadow: var(--shadow); backdrop-filter: blur(10px); overflow:hidden; }

.topbar{ padding:14px; border-bottom:1px solid var(--line); display:flex; flex-direction:column; gap:12px; }
.topbar-actions { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; width: 100%; }
.searchWrap{ display: flex; gap: 6px; align-items: center; width: 100%; }
.searchWrap input { flex:1; width:100%; padding:10px 12px; border-radius:14px; border:1px solid var(--line); background: rgba(0,0,0,.18); color: var(--text); outline:none; transition: all 0.2s; font-size: 14px;}
.searchWrap input:focus { border-color: rgba(124,92,255,.6); box-shadow: 0 0 0 4px rgba(124,92,255,.14); }

.btn{ border:1px solid var(--line); background: rgba(0,0,0,.18); color: var(--text); padding:10px 12px; border-radius:14px; font-weight:900; cursor:pointer; transition: all .15s ease; font-size:13px; }
.btn:hover{ background: rgba(255,255,255,.06); }
.btn:active{ transform: scale(.98); }
.btn.primary{ border-color: rgba(124,92,255,.55); background: linear-gradient(135deg, rgba(124,92,255,.55), rgba(124,92,255,.15)); }
.btn.danger{ border-color: rgba(239,68,68,.45); background: linear-gradient(135deg, rgba(239,68,68,.35), rgba(239,68,68,.12)); color: #ff8a8a; }
.btn.soft{ border-color: rgba(255,255,255,.14); background: rgba(255,255,255,.04); }
.btn-close { padding: 8px 14px; font-size: 13px; border-radius: 12px; }

input:-webkit-autofill, input:-webkit-autofill:hover, input:-webkit-autofill:focus, input:-webkit-autofill:active{
    -webkit-box-shadow: 0 0 0 30px #161b2a inset !important;
    -webkit-text-fill-color: var(--text) !important;
    transition: background-color 5000s ease-in-out 0s;
}

.filtersBar{ width: 100%; display: flex; gap: 8px; padding: 14px; flex-wrap: wrap; border-bottom: 1px solid var(--line); background: rgba(0,0,0,0.1); }
.filterBtn{ padding: 8px 14px; border-radius: 999px; border: 1px solid var(--line); background: rgba(0,0,0,.18); color: var(--muted); font-size: 13px; font-weight: 800; cursor: pointer; }
.filterBtn.active{ background: var(--text); color: var(--bg0); border-color: var(--text); }

.bulkBar{ display: none; align-items: center; gap: 10px; padding: 12px 14px; background: rgba(124,92,255,.15); border-bottom: 1px solid rgba(124,92,255,.3); }
.bulkBar .selCount{ font-weight: 900; color: #fff; background: var(--accent); padding: 4px 10px; border-radius: 99px; font-size: 12px; }

.statChip{ display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; border:1px solid var(--line); background: rgba(0,0,0,.18); font-size:12px; font-weight:900; color: var(--text); margin-inline-start: auto; }
.statChip.sync{ border-color: rgba(124,92,255,.45); background: rgba(124,92,255,.10); }

input[type="checkbox"] { appearance: none; width: 18px; height: 18px; border: 2px solid var(--muted); border-radius: 4px; background: rgba(0,0,0,.2); cursor: pointer; position: relative; display: inline-block; vertical-align: middle; }
input[type="checkbox"]:checked { background: var(--accent); border-color: var(--accent); }
input[type="checkbox"]:checked::after { content: "âœ”"; position: absolute; color: white; font-size: 12px; left: 3px; top: -1px; font-weight: bold; }

.tableWrap{ overflow:auto; }
table{ width:100%; border-collapse:separate; border-spacing:0; min-width: 850px; }
thead th{ position:sticky; top:0; z-index:5; background: rgba(0,0,0,.22); color: var(--muted); text-align:right; font-size:12px; font-weight:900; padding:14px 12px; border-bottom:1px solid var(--line); }
tbody td{ padding:12px; border-bottom:1px solid rgba(255,255,255,.05); white-space:nowrap; vertical-align:middle; }

tr.expired-row{ background: rgba(239,68,68,.08); }
tr.expiring-row{ background: rgba(245,158,11,.06); }
tr.expired-row td:nth-child(2){ box-shadow: inset 4px 0 0 rgba(239,68,68,.85); }
tr.expiring-row td:nth-child(2){ box-shadow: inset 4px 0 0 rgba(245,158,11,.85); }

.badge{ display:inline-flex; align-items:center; padding:4px 8px; border-radius:999px; border:1px solid var(--line); font-size:11px; font-weight:900; }
.badge.ok{ border-color: rgba(34,197,94,.45); color:#c8f7d9; background: rgba(34,197,94,.1); }
.badge.warn{ border-color: rgba(245,158,11,.45); color:#ffe2b3; background: rgba(245,158,11,.1); }
.badge.err{ border-color: rgba(239,68,68,.45); color:#ffd0d0; background: rgba(239,68,68,.1); }

.service-badge { background: rgba(124,92,255,0.15); color: #a78bfa; padding: 4px 8px; border-radius: 6px; font-weight: bold; font-size: 11px; border: 1px solid rgba(124,92,255,0.3); display: inline-block; }

.modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,.75); z-index:9999; padding: 18px; }
.modal[aria-hidden="false"]{ display:flex; }
.modal .box{ width:min(860px, 100%); background: rgba(10,14,26,.96); border: 1px solid rgba(255,255,255,.10); border-radius: 22px; box-shadow: 0 30px 90px rgba(0,0,0,.65); overflow:hidden; max-height: 90vh; overflow-y: auto; }
.modalHeader{ padding:16px 20px; border-bottom:1px solid rgba(255,255,255,.10); display:flex; align-items:center; justify-content:space-between; gap:10px; position: sticky; top: 0; background: rgba(10,14,26,.96); z-index: 10; backdrop-filter: blur(5px); }
.modalHeader h2{margin:0;font-size:18px}
.modalHeader .hint{color:var(--muted);font-size:12px}
.modalBody{ padding: 20px; }
.modalFooter{ padding:16px 20px; border-top:1px solid rgba(255,255,255,.10); display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-start; position: sticky; bottom: 0; background: rgba(10,14,26,.96); z-index: 10; }

.formGrid{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px; }
.full-width { grid-column: 1 / -1 !important; }
@media (max-width: 768px){ .formGrid{ grid-template-columns: 1fr; } }

.field label{ display:block; font-weight:900; font-size:13px; color: var(--muted); margin-bottom:8px; }
.field input, .field select{ background: rgba(0,0,0,.3); border:1px solid rgba(255,255,255,.15); width:100%; padding:12px 14px; border-radius:14px; color: var(--text); outline:none; transition: all 0.2s; font-size: 14px; }
.field input:focus, .field select:focus{ border-color: rgba(124,92,255,.6); box-shadow: 0 0 0 4px rgba(124,92,255,.14); background:rgba(0,0,0,0.5); }

.actionPill{ padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); color: var(--text); font-weight: 900; cursor:pointer; font-size: 12px; }
.actGrid{ display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:12px; }
@media (max-width: 640px){ .actGrid{ grid-template-columns: 1fr; } }
.actBtn{ border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); color: var(--text); padding: 14px; border-radius: 18px; font-weight: 900; cursor:pointer; }

.toast{ position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%) translateY(20px); padding: 12px 14px; border-radius: 16px; background: rgba(10,14,26,.92); border: 1px solid rgba(255,255,255,.12); color: var(--text); display: flex; align-items: center; gap: 10px; opacity: 0; pointer-events: none; transition: all .2s ease; z-index: 10000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); font-weight:bold; }
.toast.show{ opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto;}

.auth-wrap { text-align: center; padding: 10px 15px; }
.auth-icon-wrap { display:inline-flex; align-items:center; justify-content:center; width:75px; height:75px; background:linear-gradient(135deg, rgba(124,92,255,0.2), rgba(124,92,255,0.05)); border:1px solid rgba(124,92,255,0.3); border-radius:50%; font-size:32px; margin-bottom:15px; box-shadow: 0 10px 25px rgba(124,92,255,0.15); }
.auth-title { margin:0 0 5px 0; font-size:24px; color:var(--text); font-weight:900; }
.auth-sub { color:var(--muted); font-size:13px; margin-bottom: 30px; }
.auth-input { width:100%; padding:15px 18px; background:rgba(0,0,0,0.4); border:1px solid rgba(255,255,255,0.1); border-radius:16px; color:#fff; font-size:15px; outline:none; transition:all 0.2s; text-align: left; direction: ltr; }
.auth-input:focus { border-color: rgba(124,92,255,.6); box-shadow: 0 0 0 4px rgba(124,92,255,.14); background:rgba(0,0,0,0.6); }
.auth-label { font-size:13px; color:var(--muted); margin-bottom:8px; display:block; text-align: right; font-weight: bold; }

.receipt-table { min-width: 0 !important; width: 100% !important; } 

@media print {
    body > *:not(#receiptModal) { display: none !important; }
    body { background: white !important; padding: 0 !important; margin: 0 !important; }
    
    #receiptModal { display: block !important; position: static !important; background: white !important; }
    #receiptModal .box { width: 100% !important; max-width: none !important; box-shadow: none !important; border: none !important; border-radius: 0 !important; padding: 0 !important; }
    
    .no-print { display: none !important; }
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>
<div class="container">
  <div class="header">
    <h1>ğŸ§¾ Ù„ÙˆØ­Ø© ØªØ³ÙŠÙŠØ± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª <span class="version-badge">v11.5</span></h1>
    <div class="sub">âš¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØµØ§ÙÙŠØ© (Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…ÙƒØ±Ø±Ø© ÙˆØ§Ù„ÙØ§ØªÙˆØ±Ø©)</div>
  </div>

  <div class="card">
    <div class="topbar">
      <div class="topbar-actions">
        <button class="btn primary" id="openAdd" type="button">â• Ø¥Ø¶Ø§ÙØ©</button>
        <button class="btn soft" id="openTotals" type="button">ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</button>
        <button class="btn soft" id="openAuth" type="button" style="border-color:var(--accent); color:var(--accent);">ğŸ‘¤ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
        <button class="btn soft" id="openToolsModal" type="button">âš™ï¸ Ø£Ø¯ÙˆØ§Øª</button>
        
        <div class="statChip sync" id="syncChip"><span class="ico">â˜ï¸</span> <span class="v" id="syncVal">â€”</span></div>
      </div>

      <div class="searchWrap">
        <input id="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ØŒ Ø§Ù„Ù‡Ø§ØªÙØŒ Ø£Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©..." />
        <button class="btn soft" id="pasteSearchBtn" title="Ù„ØµÙ‚ Ø§Ù„Ø¨Ø­Ø«" style="padding: 10px 12px; border-radius: 12px; font-size: 15px;">ğŸ“‹</button>
        <button class="btn soft" id="clearSearchBtn" title="Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«" style="padding: 10px 12px; border-radius: 12px; font-size: 15px; color: var(--err);">âœ•</button>
      </div>
    </div>

    <div class="bulkBar" id="bulkBar">
      <div class="selCount" id="selCount">0 Ù…Ø­Ø¯Ø¯</div>
      <button class="btn" id="bulkExtend" style="border-color:var(--accent); color:var(--accent);">ğŸ” ØªØ¬Ø¯ÙŠØ¯</button>
      <button class="btn danger" id="bulkDelete">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      <button class="btn soft" id="clearSelection" style="margin-inline-start:auto;">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>
    </div>

    <div class="filtersBar" id="filtersBar">
      <button class="filterBtn active" data-filter="all">Ø§Ù„ÙƒÙ„</button>
      <button class="filterBtn" data-filter="active">âœ… ÙØ¹Ù‘Ø§Ù„</button>
      <button class="filterBtn" data-filter="expiring">â° Ù‚Ø±ÙŠØ¨ ÙŠÙ†ØªÙ‡ÙŠ</button>
      <button class="filterBtn" data-filter="expired">âŒ Ù…Ù†ØªÙ‡ÙŠ</button>
    </div>

    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th style="width: 40px; text-align: center;"><input type="checkbox" id="selectAll"></th>
            <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
            <th>Ø§Ù„Ù‡Ø§ØªÙ</th> 
            <th>Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th> 
            <th>Ø§Ù„Ù…Ø§Ù„ÙŠØ©</th> 
            <th>Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</th> 
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th> 
            <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<div class="modal" id="toolsModal" aria-hidden="true">
  <div class="box" style="width: 480px">
    <div class="modalHeader">
      <h2>âš™ï¸ Ø£Ø¯ÙˆØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h2>
      <button class="btn danger btn-close" type="button" onclick="closeModal('toolsModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div class="modalBody">
      <div class="actGrid">
        <button class="actBtn" id="exportCsvBtn" style="color:#10b981; border-color:rgba(16,185,129,0.4); background:rgba(16,185,129,0.1);">ğŸ“¥ ØªØµØ¯ÙŠØ± Excel</button>
        <button class="actBtn" id="undoDeleteBtn" style="color:#f59e0b; border-color:rgba(245,158,11,0.4); background:rgba(245,158,11,0.1);">â†©ï¸ Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø§Ù„Ø­Ø°Ù</button>
        <button class="actBtn" id="openBackup">ğŸ“¦ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
        <button class="actBtn" id="openSync">â˜ï¸ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</button>
        <button class="actBtn" id="shareBtn">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù„ÙˆØ­Ø©</button>
        <button class="actBtn" id="printBtn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
        <button class="actBtn danger" id="clearBtn" style="grid-column: span 2;">ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="formModal" aria-hidden="true">
  <div class="box" role="dialog" aria-modal="true">
    <div class="modalHeader">
      <div><h2 id="formTitle">Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ</h2><div class="hint">Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ù… Ø§Ø¶ØºØ· Ø­ÙØ¸</div></div>
      <button class="btn danger btn-close" type="button" onclick="closeModal('formModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div class="modalBody">
      <div class="formGrid">
        <div class="field full-width"><label>Ø§Ù„Ø§Ø³Ù… <span style="color:var(--err)">*</span></label><input id="name" placeholder="Ù…Ø«Ø§Ù„: Ahmed"></div>
        <div class="field full-width">
          <label>Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ø¹ Ø§Ù„Ø±Ù…Ø²)</label>
          <div style="display: flex; gap: 8px;">
            <select id="countryCode" style="width: 110px; direction: ltr;">
              <option value="+213">ğŸ‡©ğŸ‡¿ +213</option><option value="+212">ğŸ‡²ğŸ‡¦ +212</option><option value="+216">ğŸ‡¹ğŸ‡³ +216</option><option value="">Ø¨Ø¯ÙˆÙ† Ø±Ù…Ø²</option>
            </select>
            <input id="phone" type="tel" dir="ltr" placeholder="555000000" style="flex:1;">
          </div>
        </div>
        <div class="field full-width"><label>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ) <span style="color:var(--err)">*</span></label><input id="email" placeholder="name@example.com" inputmode="email"></div>
        
        <div class="field full-width">
          <label>Ø§Ù„Ø®Ø¯Ù…Ø© / Ø§Ù„Ø¨Ø§Ù‚Ø© <span style="color:var(--err)">*</span></label>
          <input id="serviceType" list="serviceList" placeholder="Ø§Ø®ØªØ± Ø£Ùˆ Ø§ÙƒØªØ¨ Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ù…Ø«Ø§Ù„: Netflix)">
          <datalist id="serviceList"><option value="IPTV"><option value="Netflix"><option value="Canva Pro"><option value="YouTube Premium"><option value="Office 365"></datalist>
        </div>

        <div class="field"><label>Ø§Ù„Ù…Ø¯Ø© <span style="color:var(--err)">*</span></label><input id="months" type="number" min="1" step="1"></div>
        <div class="field"><label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label><input id="price" type="number" min="0" step="0.01"></div>
        <div class="field"><label>Ø§Ù„Ø¹Ù…Ù„Ø©</label><select id="currency"><option value="DZD">DZD</option><option value="EUR">EUR</option><option value="USD">USD</option><option value="MAD">MAD</option><option value="TND">TND</option></select></div>
        
        <div class="field"><label>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</label>
          <select id="paymentStatus">
            <option value="paid">ğŸŸ¢ Ø®Ø§Ù„Øµ (Ù…Ø¯ÙÙˆØ¹)</option>
            <option value="partial">ğŸŸ¡ Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ (Ø¯ÙŠÙ†)</option>
            <option value="unpaid">ğŸ”´ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹ (Ø¯ÙŠÙ†)</option>
          </select>
        </div>
        <div class="field" id="paidAmountWrap" style="display:none;"><label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ø§Ù„Ø¢Ù†</label><input id="paidAmount" type="number" min="0" step="0.01"></div>
        <div class="field"><label>Ø§Ø®ØªÙŠØ§Ø± Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…Ø¯Ø©</label><select id="quickPlan"><option value="">â€” Ø§Ø®ØªØ± â€”</option><option value="1">1 Ø´Ù‡Ø±</option><option value="3">3 Ø£Ø´Ù‡Ø±</option><option value="6">6 Ø£Ø´Ù‡Ø±</option><option value="12">12 Ø´Ù‡Ø±</option></select></div>

        <div class="field"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© <span style="color:var(--err)">*</span></label><input id="start" type="date"></div>
        <div class="field"><label>ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø¨Ù„ (Ø£ÙŠØ§Ù…)</label><input id="alertDays" type="number" min="1" step="1" value="7"></div>
      </div>
    </div>
    <div class="modalFooter"><button class="btn primary" id="saveBtn" type="button" style="padding: 12px 24px; font-size: 14px;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button></div>
  </div>
</div>

<div class="modal" id="storeSettingsModal" aria-hidden="true">
  <div class="box" style="width: 400px">
    <div class="modalHeader"><h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± (Ø§Ù„Ù„ÙˆØ¬Ùˆ)</h2><button class="btn danger btn-close" type="button" onclick="closeModal('storeSettingsModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div>
    <div class="modalBody">
       <div class="field" style="margin-bottom:15px"><label>Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©)</label><input id="setStoreName" placeholder="Ù…Ø«Ø§Ù„: Ù…ØªØ¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª"></div>
       <div class="field" style="margin-bottom:15px"><label>Ø§Ù„Ø´Ø¹Ø§Ø± (Logo)</label><input type="file" id="setStoreLogo" accept="image/*" style="padding: 8px;"></div>
       <div style="text-align:center; padding:10px; background:rgba(255,255,255,0.05); border-radius:12px;"><div style="font-size:12px; color:var(--muted); margin-bottom:5px;">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø¹Ø§Ø±:</div><img id="logoPreview" src="" style="max-width:100px; max-height:100px; border-radius:10px; display:none; margin: 0 auto;"><div id="logoEmojiFallback" style="font-size:40px;">ğŸ’</div></div>
       <button class="btn primary" id="saveStoreSettingsBtn" style="width:100%; margin-top:20px; padding:14px; border-radius:14px;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </div>
  </div>
</div>

<div class="modal" id="receiptModal" aria-hidden="true">
  <div class="box" style="width: 450px; background: #ffffff; color: #000000; border: none; border-radius: 12px;">
    <div class="modalHeader no-print" style="background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
      <h2 style="color: #0f172a;">ğŸ“„ Ø§Ù„ÙˆØµÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ</h2>
      <button class="btn btn-close" type="button" style="background:#f1f5f9; color:#ef4444; border:1px solid #e2e8f0;" onclick="closeModal('receiptModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div class="modalBody receipt-content" style="padding: 30px 25px; font-family: Tahoma, Arial, sans-serif; background: #ffffff;">
      <div style="text-align: center; margin-bottom: 25px;">
        <img id="receiptLogoImg" src="" style="display:none; max-width:80px; max-height:80px; border-radius:12px; margin:0 auto 10px;">
        <div id="receiptLogoEmoji" style="font-size: 40px; margin-bottom: 5px;">ğŸ’</div>
        <h1 id="receiptStoreName" style="margin: 0; font-size: 24px; color: #4f46e5; font-weight: 900;">Ù…ØªØ¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h1>
        <div style="color: #64748b; font-size: 13px; margin-top: 5px;">ÙØ§ØªÙˆØ±Ø© Ø§Ø´ØªØ±Ø§Ùƒ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</div>
      </div>
      <table class="receipt-table" style="width: 100%; border-collapse: collapse; font-size: 15px;">
        <tr style="border-bottom: 1px dashed #cbd5e1;"><td style="padding: 12px 0; color: #64748b; width:40%;">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</td><td style="padding: 12px 0; text-align: left; font-weight: bold; color: #0f172a;" id="recName"></td></tr>
        <tr style="border-bottom: 1px dashed #cbd5e1;"><td style="padding: 12px 0; color: #64748b;">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</td><td style="padding: 12px 0; text-align: left; direction: ltr; color: #0f172a;" id="recPhone"></td></tr>
        <tr style="border-bottom: 1px dashed #cbd5e1;"><td style="padding: 12px 0; color: #64748b;">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©:</td><td style="padding: 12px 0; text-align: left; font-weight: bold; color: #8b5cf6;" id="recService"></td></tr>
        <tr style="border-bottom: 1px dashed #cbd5e1;"><td style="padding: 12px 0; color: #64748b;">Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</td><td style="padding: 12px 0; text-align: left; color: #0f172a;" id="recMonths"></td></tr>
        <tr style="border-bottom: 1px dashed #cbd5e1;"><td style="padding: 12px 0; color: #64748b;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</td><td style="padding: 12px 0; text-align: left; color: #0f172a;" id="recStart"></td></tr>
        <tr style="border-bottom: 1px solid #cbd5e1;"><td style="padding: 12px 0; color: #64748b;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</td><td style="padding: 12px 0; text-align: left; color: #0f172a;" id="recEnd"></td></tr>
        
        <tr><td style="padding: 20px 0 10px 0; color: #0f172a; font-size: 18px; font-weight: 900;">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</td><td style="padding: 20px 0 10px 0; text-align: left; font-size: 20px; font-weight: 900; color: #10b981;" id="recPrice"></td></tr>
        <tr style="border-bottom: 1px dashed #cbd5e1;"><td style="padding: 10px 0; color: #64748b;">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹:</td><td style="padding: 10px 0; text-align: left; font-weight:bold;" id="recPaymentStatus"></td></tr>
        <tr id="recPaidAmountRow" style="display:none; border-bottom: 1px dashed #cbd5e1;"><td style="padding: 10px 0; color: #64748b;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</td><td style="padding: 10px 0; text-align: left; font-weight:bold; color: #3b82f6;" id="recPaidAmount"></td></tr>
        <tr id="recRemainingRow" style="display:none; background:#fef2f2; border-bottom: 1px dashed #cbd5e1;"><td style="padding: 12px 5px; color: #ef4444; font-weight:bold; border-radius:0 8px 8px 0;">â— Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (Ø¯ÙŠÙ†):</td><td style="padding: 12px 5px; text-align: left; color: #ef4444; font-weight: 900; border-radius:8px 0 0 0;" id="recRemaining"></td></tr>
      </table>
      <div style="text-align: center; margin-top: 35px; font-size: 12px; color: #94a3b8; line-height: 1.6;">Ù†Ø´ÙƒØ±ÙƒÙ… Ø¹Ù„Ù‰ Ø«Ù‚ØªÙƒÙ… Ø¨Ù†Ø§ ğŸ¤<br><span style="font-size: 10px;">ØªÙ… Ø¥ØµØ¯Ø§Ø± Ù‡Ø°Ø§ Ø§Ù„ÙˆØµÙ„ Ø¢Ù„ÙŠØ§Ù‹ Ø¨ØªØ§Ø±ÙŠØ® <span id="recToday"></span></span></div>
    </div>
    <div class="modalFooter no-print" style="background: #f8fafc; border-top: 1px solid #e2e8f0; border-radius: 0 0 12px 12px; display:flex; gap:10px;">
      <button class="btn primary" style="flex:1; padding: 14px; font-size: 14px; border-radius: 12px; background: #4f46e5; border-color: #4338ca;" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø£Ùˆ PDF</button>
      <button class="btn primary" id="sendReceiptWaBtn" style="flex:1; padding: 14px; font-size: 14px; border-radius: 12px; background: #22c55e; border-color: #16a34a;">ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</button>
    </div>
  </div>
</div>

<div class="modal" id="extendModal" aria-hidden="true"><div class="box" style="width: 350px"><div class="modalHeader"><h2 id="extendTitle">ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h2><button class="btn danger btn-close" type="button" onclick="closeModal('extendModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div><div class="modalBody"><div class="field" style="margin-bottom:15px"><label>Ø§Ù„Ù…Ø¯Ø©</label><input id="extendValue" type="number" min="1" value="1"></div><div class="field" style="margin-bottom:20px"><label>Ø§Ù„ÙˆØ­Ø¯Ø©</label><select id="extendUnit"><option value="months">Ø£Ø´Ù‡Ø±</option><option value="days">Ø£ÙŠØ§Ù…</option></select></div><button class="btn primary" id="confirmExtendBtn" style="width:100%">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯</button></div></div></div>

<div class="modal" id="rowActionsModal" aria-hidden="true">
  <div class="box" role="dialog" aria-modal="true" style="width:min(740px, 100%)">
    <div class="modalHeader"><div><h2>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h2><div class="hint" id="rowActionsHint">â€”</div></div><button class="btn danger btn-close" type="button" onclick="closeModal('rowActionsModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div>
    <div class="modalBody">
      <div class="actGrid">
        <button class="actBtn" id="actExtend" type="button">ğŸ” ØªØ¬Ø¯ÙŠØ¯</button>
        <button class="actBtn" id="actEdit" type="button">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="actBtn" id="actReceipt" type="button" style="color: #60a5fa; border-color: rgba(96,165,250,.5); background: rgba(96,165,250,.15);">ğŸ“„ Ø¥ØµØ¯Ø§Ø± ÙˆØµÙ„</button>
        <button class="actBtn" id="actCopyEmail" type="button">ğŸ“‹ Ù†Ø³Ø® Email</button>
        <button class="actBtn" id="actWhatsApp" type="button" style="border-color: rgba(37,211,102,.5); background: rgba(37,211,102,.15); color: #4ade80;">ğŸ’¬ Ù…Ø±Ø§Ø³Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button class="actBtn danger" id="actDelete" type="button">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="authModal" aria-hidden="true">
  <div class="box" style="width: 420px; padding:0;">
    <div class="modalHeader" style="border-bottom:none; padding-bottom:0;"><button class="btn danger btn-close" type="button" id="closeAuthBtn" onclick="closeModal('authModal')" style="display:none; margin-inline-start:auto;">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div>
    <div class="modalBody" style="padding-top:0;">
      <div id="authLoginSection" class="auth-wrap"><div class="auth-icon-wrap">ğŸ”’</div><h2 class="auth-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2><div class="auth-sub">ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div><div style="margin-bottom:20px;"><label class="auth-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input id="authEmail" type="email" class="auth-input" placeholder="admin@example.com"></div><div style="margin-bottom:30px;"><label class="auth-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><input id="authPass" type="password" class="auth-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div><button class="btn primary" id="authLogin" style="width:100%; padding:16px; font-size:16px; font-weight:900; border-radius:16px; box-shadow: 0 8px 25px rgba(124,92,255,0.3);">Ø¯Ø®ÙˆÙ„ ğŸš€</button></div>
      <div id="authLoggedInSection" style="display:none; padding:10px;">
        <div style="text-align:center; margin-bottom:25px;"><div id="authStatusIcon" class="auth-icon-wrap" style="background:linear-gradient(135deg, rgba(34,197,94,0.2), rgba(34,197,94,0.05)); border-color:rgba(34,197,94,0.3); box-shadow: 0 10px 25px rgba(34,197,94,0.15);">âœ…</div><div id="authStateText" style="font-weight:900; font-size:15px; line-height:1.6;"></div></div>
        <div id="ownerDashboard" style="display:none; padding:20px; background:rgba(124,92,255,0.08); border-radius:18px; border:1px solid rgba(124,92,255,0.2); margin-bottom:25px;"><h3 style="margin-top:0; color:#fff; font-size:15px; display:flex; align-items:center; gap:8px;">ğŸ‘‘ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø§Ù„Ùƒ (Owner)</h3><button class="btn soft" onclick="closeModal('authModal'); openModal('storeSettingsModal')" style="width:100%; margin-bottom:12px; padding:12px; border-radius:12px; border-color:rgba(16,185,129,0.3); color:#10b981;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± (Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„ÙˆØ¬Ùˆ)</button><button class="btn primary" onclick="closeModal('authModal'); openModal('addAdminModal')" style="width:100%; margin-bottom:12px; padding:12px; border-radius:12px;">â• Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</button><button class="btn soft" onclick="closeModal('authModal'); loadAdminsList()" style="width:100%; padding:12px; border-radius:12px; border-color:rgba(255,255,255,0.1);">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button><button class="btn soft" onclick="closeModal('authModal'); openAuditLog()" style="width:100%; padding:12px; border-radius:12px; border-color:rgba(245,158,11,0.3); color:#f59e0b; margin-top:12px;">ğŸ•µï¸â€â™‚ï¸ Ø³Ø¬Ù„ Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡</button></div>
        <button class="btn danger" id="authLogout" style="width:100%; padding:14px; border-radius:14px; font-size:15px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø¢Ù…Ù†</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="addAdminModal" aria-hidden="true"><div class="box" style="width: 380px"><div class="modalHeader"><h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h2><button class="btn danger btn-close" type="button" onclick="closeModal('addAdminModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div><div class="modalBody"><div class="field" style="margin-bottom:15px"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input id="newAdminEmail" type="email"></div><div class="field" style="margin-bottom:15px"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£ÙƒØ«Ø±)</label><input id="newAdminPass" type="password"></div><div class="field" style="margin-bottom:25px"><label>Ù†ÙˆØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</label><select id="newAdminRole"><option value="admin">Ø£Ø¯Ù…Ù†</option><option value="owner">Ù…Ø§Ù„Ùƒ ğŸ‘‘</option></select></div><button class="btn primary" id="confirmAddAdminBtn" style="width:100%; padding:12px;">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button></div></div></div>
<div class="modal" id="manageAdminsModal" aria-hidden="true"><div class="box" style="width: 500px"><div class="modalHeader"><h2>ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2><button class="btn danger btn-close" type="button" onclick="closeModal('manageAdminsModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div><div class="modalBody"><div style="font-size:12px; color:var(--warn); margin-bottom:15px; padding:10px; background:rgba(245,158,11,0.1); border-radius:10px; border:1px solid rgba(245,158,11,0.3);"><b>Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©:</b> Ø³Ø­Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØ­Ø©.</div><div style="max-height:300px; overflow:auto;"><table style="min-width:100%;"><thead><tr><th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th><th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody id="adminsTbody"></tbody></table></div></div></div></div>

<div class="modal" id="auditLogModal" aria-hidden="true">
  <div class="box" style="width: 700px">
    <div class="modalHeader">
      <h2>ğŸ•µï¸â€â™‚ï¸ Ø³Ø¬Ù„ Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡</h2>
      <div style="display:flex; gap:10px;"><button class="btn danger" id="deleteSelectedLogsBtn" style="display:none; padding:8px 12px; font-size:12px;">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯</button><button class="btn danger btn-close" type="button" onclick="closeModal('auditLogModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div>
    </div>
    <div class="modalBody">
      <div style="max-height:400px; overflow:auto; border:1px solid rgba(255,255,255,0.1); border-radius:12px;">
        <table style="min-width:100%; font-size: 13px;">
          <thead><tr><th style="width: 40px; text-align: center;"><input type="checkbox" id="selectAllLogs"></th><th>Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ø£Ø¯Ù…Ù†)</th><th>Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th><th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th></tr></thead>
          <tbody id="auditTbody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="backupModal" aria-hidden="true"><div class="box" style="width:400px"><div class="modalHeader"><h2>ğŸ“¦ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ (JSON)</h2><button class="btn danger btn-close" type="button" onclick="closeModal('backupModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div><div class="modalBody"><div style="display:grid; gap:10px;"><button class="btn soft" id="exportJsonBtn">â¬‡ï¸ ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© JSON</button><button class="btn soft" id="importFileBtn">â¬†ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© JSON</button><input id="fileInput" type="file" accept=".json" style="display:none"><button class="btn soft" onclick="openModal('pasteModal')">ğŸ“‹ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ø§Ù„Ù„ØµÙ‚</button></div></div></div></div>
<div class="modal" id="pasteModal" aria-hidden="true"><div class="box"><div class="modalHeader"><h2>ğŸ“‹ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ø§Ù„Ù„ØµÙ‚</h2><button class="btn danger btn-close" type="button" onclick="closeModal('pasteModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div><div class="modalBody"><textarea id="pasteArea" rows="10" style="width:100%; background:rgba(0,0,0,0.3); color:white; border:1px solid rgba(255,255,255,0.1); padding:10px; border-radius:10px; outline:none;"></textarea></div><div class="modalFooter"><button class="btn primary" id="confirmPasteBtn">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button></div></div></div>
<div class="modal" id="syncModal" aria-hidden="true"><div class="box"><div class="modalHeader"><h2>â˜ï¸ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙˆØ§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h2><button class="btn danger btn-close" type="button" onclick="closeModal('syncModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div><div class="modalBody">Ù…ÙŠØ²Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ØªØ¹Ù…Ù„ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ø­Ø¸ÙŠØ§Ù‹ ÙˆØ¨Ø´ÙƒÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ âœ…</div></div></div>
<div class="modal" id="totalsModal" aria-hidden="true"><div class="box" style="width:400px"><div class="modalHeader"><h2>ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¹Ø§Ù…</h2><button class="btn danger btn-close" type="button" onclick="closeModal('totalsModal')">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div><div class="modalBody"><div id="totalsBody" style="text-align:center; padding: 10px 0;"></div></div></div></div>

<div id="toast" class="toast"></div>

<script>
'use strict';
const FIREBASE_CONFIG = { apiKey: "AIzaSyAQPzqeazhj4rjyY1dbcGZ9YEAv8ZhLQbQ", authDomain: "dattta-6f497.firebaseapp.com", databaseURL: "https://dattta-6f497-default-rtdb.firebaseio.com", projectId: "dattta-6f497", storageBucket: "dattta-6f497.firebasestorage.app", messagingSenderId: "804914291938", appId: "1:804914291938:web:7a7d3fe8a5ebb28a306abb" };

const $ = (id)=>document.getElementById(id);
const LOCAL_BACKUP_KEY = "subs_local_backup_v6";
let data = []; let editingId = null; let currentRowId = null; let currentFilter = "all"; 
let selectedIds = new Set(); let extendMode = "single";
let currentUser = null; let currentRole = null;
let lastDeletedData = null; 
let storeSettings = { name: "Ù…ØªØ¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª", logo: "" };

if(!firebase.apps.length) firebase.initializeApp(FIREBASE_CONFIG);
const auth = firebase.auth(); const db = firebase.database();

async function logAction(actionName, detailsStr) { if (!currentUser) return; try { await db.ref("logs").push({ email: currentUser.email, action: actionName, details: detailsStr || "-", time: new Date().toISOString() }); } catch(e) { } }

let selectedLogIds = new Set();
function updateLogBulkUI() { if(selectedLogIds.size > 0) { $("deleteSelectedLogsBtn").style.display = "block"; $("deleteSelectedLogsBtn").textContent = `ğŸ—‘ï¸ Ø­Ø°Ù (${selectedLogIds.size})`; } else { $("deleteSelectedLogsBtn").style.display = "none"; $("selectAllLogs").checked = false; } }
$("selectAllLogs").onchange = (e) => { const isChkd = e.target.checked; document.querySelectorAll(".logChk").forEach(chk => { chk.checked = isChkd; if(isChkd) selectedLogIds.add(chk.value); else selectedLogIds.delete(chk.value); }); updateLogBulkUI(); };
$("auditTbody").addEventListener("change", (e) => { if(e.target.classList.contains("logChk")) { if(e.target.checked) selectedLogIds.add(e.target.value); else selectedLogIds.delete(e.target.value); updateLogBulkUI(); } });
$("deleteSelectedLogsBtn").onclick = async () => { if(!confirm(`ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù ${selectedLogIds.size} Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ`)) return; setSyncState("saving"); for(let id of selectedLogIds) { await db.ref("logs/" + id).remove(); } selectedLogIds.clear(); updateLogBulkUI(); setSyncState("ok"); showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª"); openAuditLog(); };
window.openAuditLog = async () => { selectedLogIds.clear(); updateLogBulkUI(); const tb = $("auditTbody"); tb.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px;'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„... â³</td></tr>"; openModal("auditLogModal"); try { const snap = await db.ref("logs").orderByChild("time").limitToLast(100).once("value"); const logsObj = snap.val() || {}; tb.innerHTML = ""; const logsArray = Object.entries(logsObj).map(([key, val]) => ({id: key, ...val})).sort((a,b) => new Date(b.time) - new Date(a.time)); if(logsArray.length === 0) { tb.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px; color:var(--muted);'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª</td></tr>"; return; } logsArray.forEach(l => { const d = new Date(l.time); const timeStr = d.toLocaleDateString('en-GB') + " - " + d.toLocaleTimeString('en-GB'); let actionColor = "var(--text)"; if(l.action.includes("Ø­Ø°Ù")) actionColor = "#ef4444"; else if(l.action.includes("Ø¥Ø¶Ø§ÙØ©")) actionColor = "#22c55e"; else if(l.action.includes("ØªØ¹Ø¯ÙŠÙ„") || l.action.includes("ØªØ¬Ø¯ÙŠØ¯") || l.action.includes("ÙˆØµÙ„")) actionColor = "#f59e0b"; const isChecked = selectedLogIds.has(l.id) ? "checked" : ""; tb.innerHTML += `<tr><td style="text-align: center;"><input type="checkbox" class="logChk" value="${l.id}" ${isChecked}></td><td style="direction:ltr; text-align:right; color:var(--muted);">${timeStr}</td><td>${l.email}</td><td style="color:${actionColor}; font-weight:bold;">${l.action}</td><td>${l.details}</td></tr>`; }); } catch(err) { tb.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px; color:var(--err)'>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„</td></tr>"; } };

auth.onAuthStateChanged(async (u)=>{ currentUser = u; if(u){ try { const roleSnap = await db.ref("admins/" + u.uid).once("value"); let roleData = roleSnap.val(); if(roleData === true) { try { roleData = { role: "owner", email: u.email }; await db.ref("admins/" + u.uid).set(roleData); } catch(writeErr) { roleData = { role: "owner", email: u.email }; } } currentRole = (roleData && roleData.role) ? roleData.role : "admin"; } catch(e) { currentRole = "admin"; } $("closeAuthBtn").style.display = "block"; closeModal("authModal"); await load(); } else { currentRole = null; data = []; render(); $("closeAuthBtn").style.display = "none"; openModal("authModal"); } updateAuthUI(); });
function updateAuthUI() { if(currentUser) { $("authLoginSection").style.display = "none"; $("authLoggedInSection").style.display = "block"; const iconEl = $("authStatusIcon"); const textEl = $("authStateText"); if (currentRole === "owner") { iconEl.innerHTML = "ğŸ‘‘"; iconEl.style.background = "linear-gradient(135deg, rgba(245,158,11,0.2), rgba(245,158,11,0.05))"; iconEl.style.borderColor = "rgba(245,158,11,0.4)"; iconEl.style.boxShadow = "0 10px 25px rgba(245,158,11,0.15)"; textEl.innerHTML = `<span style="color:var(--warn); font-size:22px; font-weight:900;">Ø§Ù„Ù…Ø§Ù„Ùƒ</span><br/><span style="color:var(--text); font-size:15px; margin-top:8px; display:inline-block; direction:ltr;">${currentUser.email}</span><br/><span style="color:var(--muted); font-size:13px; margin-top:6px; display:inline-block;">(Ø­Ø³Ø§Ø¨ Ù…ØªØµÙ„ âœ…)</span>`; } else { iconEl.innerHTML = "ğŸ‘¤"; iconEl.style.background = "linear-gradient(135deg, rgba(34,197,94,0.2), rgba(34,197,94,0.05))"; iconEl.style.borderColor = "rgba(34,197,94,0.3)"; iconEl.style.boxShadow = "0 10px 25px rgba(34,197,94,0.15)"; textEl.innerHTML = `<span style="color:var(--text); font-size:20px; font-weight:900;">Ø£Ø¯Ù…Ù†</span><br/><span style="color:var(--text); font-size:15px; margin-top:8px; display:inline-block; direction:ltr;">${currentUser.email}</span><br/><span style="color:var(--muted); font-size:13px; margin-top:6px; display:inline-block;">(Ø­Ø³Ø§Ø¨ Ù…ØªØµÙ„ âœ…)</span>`; } $("ownerDashboard").style.display = currentRole === "owner" ? "block" : "none"; } else { $("authLoginSection").style.display = "block"; $("authLoggedInSection").style.display = "none"; } }

$("setStoreLogo").onchange = (e) => { const file = e.target.files[0]; if(file){ const reader = new FileReader(); reader.onload = (ev) => { $("logoPreview").src = ev.target.result; $("logoPreview").style.display = "block"; $("logoEmojiFallback").style.display = "none"; }; reader.readAsDataURL(file); } };
$("saveStoreSettingsBtn").onclick = async () => { const name = $("setStoreName").value.trim() || "Ù…ØªØ¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª"; const logo = $("logoPreview").src || ""; storeSettings = { name, logo }; try { setSyncState("saving"); await db.ref("settings/storeInfo").set(storeSettings); setSyncState("ok"); closeModal("storeSettingsModal"); showToast("ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± âœ¨"); } catch(e) { showToast("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", "err"); } };

$("confirmAddAdminBtn").onclick = async () => { const email = $("newAdminEmail").value.trim(); const pass = $("newAdminPass").value; const role = $("newAdminRole").value; if(!email || pass.length < 6) return showToast("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø©", "err"); try { setSyncState("saving"); const secondaryApp = firebase.initializeApp(FIREBASE_CONFIG, "SecondaryApp"); const userCredential = await secondaryApp.auth().createUserWithEmailAndPassword(email, pass); await db.ref("admins/" + userCredential.user.uid).set({ role: role, email: email }); await secondaryApp.auth().signOut(); await secondaryApp.delete(); closeModal("addAdminModal"); $("newAdminEmail").value = ""; $("newAdminPass").value = ""; showToast(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨!`); setSyncState("ok"); } catch (error) { if(error.code === 'auth/email-already-in-use') showToast("Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹", "err"); else showToast("Ø®Ø·Ø£: " + error.message, "err"); setSyncState("fail"); try { const app = firebase.app("SecondaryApp"); if(app) await app.delete(); } catch(e){} } };
window.loadAdminsList = async () => { openModal("manageAdminsModal"); const tb = $("adminsTbody"); tb.innerHTML = "<tr><td colspan='3' style='text-align:center; padding:20px;'>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>"; try { const snap = await db.ref("admins").once("value"); const adminsObj = snap.val() || {}; tb.innerHTML = ""; for(let uid in adminsObj) { let uData = adminsObj[uid]; let isOwner = uData.role === "owner" || uData === true; let actionBtn = uid === currentUser.uid ? `<span style="color:var(--muted); font-size:12px;">Ø­Ø³Ø§Ø¨Ùƒ</span>` : `<button class="btn danger" style="padding:6px 10px; font-size:12px; border-radius:10px;" onclick="revokeAdmin('${uid}')">Ø³Ø­Ø¨ ØµÙ„Ø§Ø­ÙŠØ©</button>`; tb.innerHTML += `<tr><td>${uData.email || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td><td>${isOwner?"Ù…Ø§Ù„Ùƒ ğŸ‘‘":"Ø£Ø¯Ù…Ù† ğŸ‘¤"}</td><td>${actionBtn}</td></tr>`; } } catch(err) { tb.innerHTML = "<tr><td colspan='3' style='text-align:center; padding:20px; color:var(--err)'>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</td></tr>"; } };
window.revokeAdmin = async (uid) => { if(confirm("ØªØ£ÙƒÙŠØ¯ Ø³Ø­Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©ØŸ")) { await db.ref("admins/" + uid).remove(); showToast("ØªÙ… Ø³Ø­Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ âœ…"); loadAdminsList(); } };

function todayISO(){ const d=new Date(); d.setHours(0,0,0,0); return d.toISOString().slice(0,10); }
function toDate(iso){ const d=new Date(iso+"T00:00:00"); d.setHours(0,0,0,0); return d; }
function saveLocalBackup(){ localStorage.setItem(LOCAL_BACKUP_KEY, JSON.stringify(data)); }
function loadLocalBackup(){ try { const j = JSON.parse(localStorage.getItem(LOCAL_BACKUP_KEY)); return Array.isArray(j) ? j : []; } catch { return []; } }
function setSyncState(state){ const chip = $("syncChip"); const val = $("syncVal"); chip.className = "statChip sync " + state; if(!navigator.onLine) val.textContent = "Ø£ÙˆÙÙ„Ø§ÙŠÙ† ğŸ“´"; else if(state==="saving") val.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸..."; else if(state==="ok") { const d = new Date(); val.textContent = d.getHours()+":"+String(d.getMinutes()).padStart(2,"0") + " âœ…"; } else if(state==="fail") { val.textContent = "Ø®Ø·Ø£ Ø§ØªØµØ§Ù„ âŒ"; chip.style.borderColor="var(--err)"; chip.style.background="rgba(239,68,68,0.1)"; } }

async function load() { 
  if(!navigator.onLine) { data = loadLocalBackup(); render(); return; } 
  try { 
    setSyncState("saving"); 
    try { const settingsSnap = await db.ref("settings/storeInfo").once('value'); if(settingsSnap.exists()) { storeSettings = settingsSnap.val(); $("setStoreName").value = storeSettings.name || ""; if(storeSettings.logo) { $("logoPreview").src = storeSettings.logo; $("logoPreview").style.display = "block"; $("logoEmojiFallback").style.display = "none"; } } } catch(errSettings) { console.log("ØªÙ… ØªØ®Ø·ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"); } 
    const snap = await db.ref("subscriptions").once('value'); data = snap.val() ? Object.values(snap.val()) : []; saveLocalBackup(); setSyncState("ok"); render(); 
  } catch(e) { 
    setSyncState("fail"); 
    showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±. ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©.", "warn"); 
    data = loadLocalBackup();
    render(); 
  } 
}

async function firebasePush() { if(!navigator.onLine) return; try { setSyncState("saving"); await db.ref("subscriptions").set(data); saveLocalBackup(); setSyncState("ok"); } catch(e) { showToast("Ø®Ø·Ø£", "err"); } }
function getStatus(endISO, alertDays) { const left = Math.round((toDate(endISO) - toDate(todayISO()))/(1000*60*60*24)); if(left < 0) return {key:"expired", label:"Ù…Ù†ØªÙ‡ÙŠ", cls:"err", left}; if(left <= alertDays) return {key:"expiring", label:"Ù‚Ø±ÙŠØ¨ ÙŠÙ†ØªÙ‡ÙŠ", cls:"warn", left}; return {key:"active", label:"ÙØ¹Ù‘Ø§Ù„", cls:"ok", left}; }

function render(){
  const searchInput = $("search"); const q = searchInput ? (searchInput.value || "").trim().toLowerCase() : "";
  const tb = $("tbody"); tb.innerHTML = ""; if($("selectAll")) $("selectAll").checked = false;
  const alertEl = $("alertDays"); const alertD = (alertEl && alertEl.value) ? parseInt(alertEl.value) : 7;
  
  const rows = data.filter(r => { 
    if(!r) return false;
    const n = (r.name || "").toString().toLowerCase(); const p = (r.phone || "").toString().toLowerCase();
    const e = (r.email || "").toString().toLowerCase(); const srv = (r.serviceType || "").toString().toLowerCase(); 
    const match = !q || n.includes(q) || p.includes(q) || e.includes(q) || srv.includes(q); 
    const st = getStatus(r.end, alertD); 
    if(currentFilter !== "all" && currentFilter !== st.key) return false; return match; 
  });
  
  if(rows.length === 0) {
    tb.innerHTML = `<tr><td colspan="8" style="text-align:center; padding:40px; color:var(--muted); font-size:15px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§ ğŸ“­</td></tr>`;
    return;
  }

  rows.forEach(r => {
    const st = getStatus(r.end, alertD); const isChecked = selectedIds.has(r.id) ? "checked" : ""; const tr = document.createElement("tr");
    if(st.key === "expired") tr.className = "expired-row"; else if(st.key === "expiring") tr.className = "expiring-row";
    
    let pStatus = r.paymentStatus || 'paid'; let payBadge = '';
    if(pStatus === 'unpaid') payBadge = '<span class="badge err" style="padding:4px 6px; font-size:10px;">ğŸ”´ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹</span>';
    else if(pStatus === 'partial') { let rem = (parseFloat(r.price)||0) - (parseFloat(r.paidAmount)||0); payBadge = `<span class="badge warn" style="padding:4px 6px; font-size:10px;" title="Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${rem}">ğŸŸ¡ Ø¬Ø²Ø¦ÙŠ (${r.paidAmount||0})</span>`; }
    else payBadge = '<span class="badge ok" style="padding:4px 6px; font-size:10px;">ğŸŸ¢ Ø®Ø§Ù„Øµ</span>';

    const serviceHtml = `<span class="service-badge">${r.serviceType || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</span>`;
    
    tr.innerHTML = `
      <td style="text-align: center;"><input type="checkbox" class="rowChk" value="${r.id}" ${isChecked}></td>
      <td><div style="font-weight:bold; color:var(--text); font-size:14px;">${r.name||"-"}</div><div style="font-size:11px; color:var(--muted); margin-top:2px;">${r.email||''}</div></td>
      <td dir="ltr" style="text-align:right; font-size:14px;">${r.phone?`${r.countryCode||''} ${r.phone}`:'-'}</td>
      <td><div style="margin-bottom:4px;">${serviceHtml}</div><div style="font-size:11px; color:var(--muted); font-weight:bold;">Ø§Ù„Ù…Ø¯Ø©: ${r.months||0} Ø´Ù‡Ø±</div></td>
      <td><div style="font-weight:bold; font-size:14px;">${r.price||0} <span style="font-size:10px; color:var(--muted);">${r.currency||'DZD'}</span></div><div style="margin-top:4px;">${payBadge}</div></td>
      <td style="font-size:12px; color:var(--muted); line-height:1.6;"><span style="color:var(--text)">Ù…:</span> ${r.start||"-"}<br><span style="color:var(--text)">Ø¥:</span> ${r.end||"-"}</td>
      <td><div style="margin-bottom:4px;"><span class="badge ${st.cls}">${st.label}</span></div><div style="font-size:11px; font-weight:bold; color:${st.left < 0 ? 'var(--err)' : 'var(--text)'};">${st.left < 0 ? 'Ù…Ù†Ø° ' + Math.abs(st.left) : 'Ø¨Ù‚ÙŠ ' + st.left} ÙŠÙˆÙ…</div></td>
      <td><button class="actionPill" onclick="openRowActions('${r.id}')">âš¡ Ø¥Ø¬Ø±Ø§Ø¡</button></td>
    `;
    tb.appendChild(tr);
  });
}

function updateBulkUI() { const bar = $("bulkBar"); if(selectedIds.size > 0) { bar.style.display = "flex"; $("selCount").textContent = `${selectedIds.size} Ù…Ø­Ø¯Ø¯`; } else { bar.style.display = "none"; $("selectAll").checked = false; } }
$("tbody").addEventListener("change", (e) => { if(e.target.classList.contains("rowChk")) { if(e.target.checked) selectedIds.add(e.target.value); else selectedIds.delete(e.target.value); updateBulkUI(); } });
$("selectAll").addEventListener("change", (e) => { const isChkd = e.target.checked; document.querySelectorAll(".rowChk").forEach(chk => { chk.checked = isChkd; if(isChkd) selectedIds.add(chk.value); else selectedIds.delete(chk.value); }); updateBulkUI(); });
$("clearSelection").onclick = () => { selectedIds.clear(); render(); updateBulkUI(); };

$("bulkDelete").onclick = async () => { if(!confirm(`ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù ${selectedIds.size} Ø§Ø´ØªØ±Ø§ÙƒØ§ØªØŸ`)) return; logAction("Ø­Ø°Ù Ø¬Ù…Ø§Ø¹ÙŠ", `Ø¹Ø¯Ø¯ ${selectedIds.size} Ø§Ø´ØªØ±Ø§ÙƒØ§Øª`); lastDeletedData = data.filter(x => selectedIds.has(x.id)); data = data.filter(x => !selectedIds.has(x.id)); selectedIds.clear(); await firebasePush(); render(); updateBulkUI(); showToast("ØªÙ… Ø§Ù„Ø­Ø°ÙØŒ Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ù…Ù…ÙƒÙ† Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Øª ğŸ—‘ï¸"); };
$("bulkExtend").onclick = () => { extendMode = "bulk"; $("extendTitle").textContent = `ØªØ¬Ø¯ÙŠØ¯ ${selectedIds.size} Ù…Ø´ØªØ±Ùƒ`; $("extendValue").value = 1; $("extendUnit").value = "months"; openModal("extendModal"); };

window.openRowActions = (id) => { currentRowId = id; const rec = data.find(x => x.id === id); $("rowActionsHint").textContent = rec.name; openModal("rowActionsModal"); };

$("paymentStatus").addEventListener('change', (e) => { $("paidAmountWrap").style.display = e.target.value === 'partial' ? 'block' : 'none'; });

$("actReceipt").onclick = () => {
  const rec = data.find(x => x.id === currentRowId); if(!rec) return; closeModal("rowActionsModal"); 
  $("receiptStoreName").textContent = storeSettings.name || "Ù…ØªØ¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª";
  if(storeSettings.logo) { $("receiptLogoImg").src = storeSettings.logo; $("receiptLogoImg").style.display = "block"; $("receiptLogoEmoji").style.display = "none"; } 
  else { $("receiptLogoImg").style.display = "none"; $("receiptLogoEmoji").style.display = "block"; }
  
  $("recName").textContent = rec.name || "-"; $("recPhone").textContent = rec.phone ? `${rec.countryCode||''}${rec.phone}` : "-"; $("recService").textContent = rec.serviceType || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"; $("recMonths").textContent = `${rec.months || 0} Ø´Ù‡Ø±`; $("recStart").textContent = rec.start || "-"; $("recEnd").textContent = rec.end || "-"; $("recPrice").textContent = `${parseFloat(rec.price || 0).toLocaleString()} ${rec.currency || 'DZD'}`;
  
  let pStatus = rec.paymentStatus || 'paid'; 
  let pText = pStatus === 'paid' ? 'ğŸŸ¢ Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„' : (pStatus === 'unpaid' ? 'ğŸ”´ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹' : 'ğŸŸ¡ Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ'); 
  $("recPaymentStatus").textContent = pText;
  
  if(pStatus === 'partial') {
    $("recPaidAmountRow").style.display = "table-row";
    $("recPaidAmount").textContent = `${parseFloat(rec.paidAmount || 0).toLocaleString()} ${rec.currency || 'DZD'}`;
  } else {
    $("recPaidAmountRow").style.display = "none";
  }

  if(pStatus === 'partial' || pStatus === 'unpaid') { 
    $("recRemainingRow").style.display = "table-row"; 
    let total = parseFloat(rec.price) || 0; 
    let paid = pStatus === 'unpaid' ? 0 : (parseFloat(rec.paidAmount) || 0); 
    let rem = total - paid; 
    $("recRemaining").textContent = `${rem.toLocaleString()} ${rec.currency || 'DZD'}`; 
  } else { 
    $("recRemainingRow").style.display = "none"; 
  }

  const d = new Date(); $("recToday").textContent = `${d.toLocaleDateString('en-GB')} - ${d.toLocaleTimeString('en-GB')}`;
  logAction("Ø¥ØµØ¯Ø§Ø± ÙˆØµÙ„", `Ù„Ù„Ø¹Ù…ÙŠÙ„: ${rec.name}`); openModal("receiptModal"); 
};

$("sendReceiptWaBtn").onclick = () => {
  const rec = data.find(x => x.id === currentRowId); if(!rec || !rec.phone) return showToast("Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ø§ ÙŠÙ…Ù„Ùƒ Ø±Ù‚Ù… Ù‡Ø§ØªÙ", "warn");
  let cleanPhone = ((rec.countryCode||'')+rec.phone).replace(/[^0-9+]/g, ''); let sName = storeSettings.name || "Ù…ØªØ¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª"; 
  let pText = rec.paymentStatus === 'unpaid' ? 'ğŸ”´ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹' : (rec.paymentStatus === 'partial' ? 'ğŸŸ¡ Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ' : 'ğŸŸ¢ Ø®Ø§Ù„Øµ');
  
  let msg = `ğŸ§¾ *ÙØ§ØªÙˆØ±Ø© Ø§Ø´ØªØ±Ø§Ùƒ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©* ğŸ§¾\n\nğŸ¢ Ø§Ù„Ù…ØªØ¬Ø±: *${sName}*\nğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${rec.name||'-'}\nğŸ“¦ Ø§Ù„Ø®Ø¯Ù…Ø©: ${rec.serviceType||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\nâ³ Ø§Ù„Ù…Ø¯Ø©: ${rec.months||0} Ø´Ù‡Ø±\nğŸ“… Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: ${rec.start||'-'}\nğŸ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ${rec.end||'-'}\n\nğŸ’° *Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:* ${parseFloat(rec.price||0).toLocaleString()} ${rec.currency||'DZD'}\nğŸ’³ *Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹:* ${pText}\n`;
  
  if(rec.paymentStatus === 'partial') { msg += `ğŸ’¸ *Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:* ${parseFloat(rec.paidAmount||0).toLocaleString()} ${rec.currency||'DZD'}\n`; }
  if(rec.paymentStatus === 'partial' || rec.paymentStatus === 'unpaid'){ let total = parseFloat(rec.price)||0; let paid = rec.paymentStatus === 'unpaid' ? 0 : parseFloat(rec.paidAmount)||0; msg += `â— *Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (Ø¯ÙŠÙ†):* ${(total - paid).toLocaleString()} ${rec.currency||'DZD'}\n`; }
  msg += `\nğŸ¤ Ù†Ø´ÙƒØ±ÙƒÙ… Ø¹Ù„Ù‰ Ø«Ù‚ØªÙƒÙ… Ø¨Ù†Ø§!`; window.open(`https://wa.me/${cleanPhone}?text=${encodeURIComponent(msg)}`, '_blank');
};

$("actEdit").onclick = () => { 
  const rec = data.find(x => x.id === currentRowId); if(!rec) return; closeModal("rowActionsModal"); editingId = rec.id; 
  $("formTitle").textContent = "ØªØ¹Ø¯ÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ"; $("name").value = rec.name||""; $("email").value = rec.email||""; $("phone").value = rec.phone||""; $("countryCode").value = rec.countryCode||"+213"; $("serviceType").value = rec.serviceType||""; $("months").value = rec.months||""; $("price").value = rec.price||""; $("currency").value = rec.currency||"DZD"; $("start").value = rec.start; $("alertDays").value = rec.alertDays||"7"; 
  $("paymentStatus").value = rec.paymentStatus || "paid"; $("paidAmountWrap").style.display = (rec.paymentStatus === 'partial') ? "block" : "none"; $("paidAmount").value = rec.paidAmount || "";
  openModal("formModal"); 
};

$("openAdd").onclick = () => { 
  editingId=null; $("formTitle").textContent="Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ"; $("name").value=""; $("email").value=""; $("phone").value=""; $("countryCode").value="+213"; $("serviceType").value=""; $("quickPlan").value=""; $("months").value=""; $("price").value=""; $("start").value=todayISO(); 
  $("paymentStatus").value = "paid"; $("paidAmountWrap").style.display = "none"; $("paidAmount").value = ""; openModal("formModal"); 
};

$("actDelete").onclick = async () => { if(confirm("Ø­Ø°ÙØŸ")) { const recToDelete = data.find(x => x.id === currentRowId); logAction("Ø­Ø°Ù Ø§Ø´ØªØ±Ø§Ùƒ", `Ø§Ù„Ø§Ø³Ù…: ${recToDelete.name}`); lastDeletedData = data.filter(x => x.id === currentRowId); data = data.filter(x => x.id !== currentRowId); await firebasePush(); render(); closeModal("rowActionsModal"); showToast("ØªÙ… Ø§Ù„Ø­Ø°ÙØŒ Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ù…Ù…ÙƒÙ† Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Øª ğŸ—‘ï¸"); } };
$("actExtend").onclick = () => { extendMode = "single"; const rec = data.find(x => x.id === currentRowId); $("extendTitle").textContent = `ØªØ¬Ø¯ÙŠØ¯ Ù„Ù€ ${rec.name}`; $("extendValue").value = 1; $("extendUnit").value = "months"; closeModal("rowActionsModal"); openModal("extendModal"); };
$("actCopyEmail").onclick = () => { const rec = data.find(x => x.id === currentRowId); if(!rec || !rec.email) { closeModal("rowActionsModal"); return showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„.", "err"); } navigator.clipboard.writeText(rec.email); closeModal("rowActionsModal"); showToast("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ğŸ“‹"); };
$("actWhatsApp").onclick = () => { const rec = data.find(x => x.id === currentRowId); if(!rec || !rec.phone) { closeModal("rowActionsModal"); return showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù‡Ø§ØªÙ.", "err"); } let cleanPhone = ((rec.countryCode||'')+rec.phone).replace(/[^0-9+]/g, ''); window.open(`https://wa.me/${cleanPhone}?text=${encodeURIComponent(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${rec.name}ØŒ Ù†ÙˆØ¯ ØªØ°ÙƒÙŠØ±Ùƒ Ø¨Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø¨ØªØ§Ø±ÙŠØ® ${rec.end}.`)}`, '_blank'); closeModal("rowActionsModal"); };

$("confirmExtendBtn").onclick = async () => {
  const val = parseInt($("extendValue").value); const unit = $("extendUnit").value; if(isNaN(val) || val < 1) return showToast("ØºÙŠØ± ØµØ§Ù„Ø­", "err");
  if(extendMode === "bulk") { logAction("ØªØ¬Ø¯ÙŠØ¯ Ø¬Ù…Ø§Ø¹ÙŠ", `Ø¹Ø¯Ø¯ ${selectedIds.size} Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø¨Ù…Ù‚Ø¯Ø§Ø± ${val} ${unit}`); } else { const recToExtend = data.find(x => x.id === currentRowId); logAction("ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ", `Ø§Ù„Ø§Ø³Ù…: ${recToExtend.name}ØŒ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©: ${val} ${unit}`); }
  const processRecord = (rec) => { const endD = new Date(rec.end); if(unit === "months") { endD.setMonth(endD.getMonth() + val); rec.months = (parseInt(rec.months)||0) + val; } else { endD.setDate(endD.getDate() + val); } rec.end = endD.toISOString().split('T')[0]; return rec; };
  if(extendMode === "bulk") { data = data.map(x => selectedIds.has(x.id) ? processRecord(x) : x); selectedIds.clear(); updateBulkUI(); } else { data = data.map(x => x.id === currentRowId ? processRecord(x) : x); }
  await firebasePush(); render(); closeModal("extendModal"); showToast("ØªÙ… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ ğŸ”");
};

$("quickPlan").onchange = ()=>{ if($("quickPlan").value) $("months").value = $("quickPlan").value; };
$("saveBtn").onclick = async () => {
  const start = $("start").value; const months = parseInt($("months").value); const emailVal = $("email").value.trim(); const serviceVal = $("serviceType").value.trim(); 
  if(!$("name").value.trim() || !emailVal || !serviceVal || !start || isNaN(months)) { return showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ©", "err"); }
  const pStatus = $("paymentStatus").value; const pAmount = pStatus === 'partial' ? parseFloat($("paidAmount").value) || 0 : 0;
  const actionName = editingId ? "ØªØ¹Ø¯ÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ" : "Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ"; logAction(actionName, `Ø§Ù„Ø§Ø³Ù…: ${$("name").value} - Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹: ${pStatus === 'paid' ? 'Ø®Ø§Ù„Øµ' : 'Ø¯ÙŠÙ†'}`); 
  const endD = new Date(start); endD.setMonth(endD.getMonth() + months); const alertEl = $("alertDays");
  const rec = { id: editingId || Date.now().toString(), name: $("name").value, email: emailVal, phone: $("phone").value, countryCode: $("countryCode").value, serviceType: serviceVal, alertDays: (alertEl && alertEl.value)?alertEl.value:7, months, price: $("price").value, currency: $("currency").value, paymentStatus: pStatus, paidAmount: pAmount, start, end: endD.toISOString().split('T')[0] };
  if(editingId) data = data.map(x => x.id === editingId ? rec : x); else data.unshift(rec);
  await firebasePush(); render(); closeModal("formModal"); showToast("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ¨");
};

$("openToolsModal").onclick = () => { openModal("toolsModal"); };
$("exportCsvBtn").onclick = () => { 
  if(data.length === 0) return showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§", "warn"); 
  let csv = "\uFEFFØ§Ù„Ø§Ø³Ù…,Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„,Ø§Ù„Ù‡Ø§ØªÙ,Ø§Ù„Ø®Ø¯Ù…Ø©,Ø§Ù„Ù…Ø¯Ø©,Ø§Ù„Ø³Ø¹Ø±,Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹,Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡\n"; 
  data.forEach(r => { let phone = r.phone ? `${r.countryCode||''}${r.phone}` : ''; let payStat = r.paymentStatus === 'unpaid' ? 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹' : (r.paymentStatus === 'partial' ? 'Ø¬Ø²Ø¦ÙŠ' : 'Ø®Ø§Ù„Øµ'); let paidAmt = r.paymentStatus === 'unpaid' ? 0 : (r.paymentStatus === 'partial' ? (r.paidAmount||0) : (r.price||0)); csv += `${r.name||''},${r.email||''},${phone},${r.serviceType||''},${r.months||''} Ø´Ù‡Ø±,${r.price||0} ${r.currency||'DZD'},${paidAmt},${payStat},${r.start||''},${r.end||''}\n`; }); 
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = `Subscriptions_Excel_${todayISO()}.csv`; a.click(); closeModal('toolsModal'); showToast("ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ ğŸ“¥"); 
};
$("undoDeleteBtn").onclick = async () => { if(!lastDeletedData || lastDeletedData.length === 0) { closeModal('toolsModal'); return showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ø­Ø°Ù Ø£Ø®ÙŠØ± Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹Ù‡", "warn"); } logAction("ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø§Ù„Ø­Ø°Ù", `Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ${lastDeletedData.length} Ø§Ø´ØªØ±Ø§ÙƒØ§Øª`); data = [...lastDeletedData, ...data]; lastDeletedData = null; await firebasePush(); render(); closeModal('toolsModal'); showToast("ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© â†©ï¸"); };

$("openTotals").onclick = () => { 
  const alertEl = $("alertDays"); const alertD = (alertEl && alertEl.value) ? parseInt(alertEl.value) : 7;
  const activeData = data.filter(r => getStatus(r.end, alertD).key !== "expired"); 
  const totalsByCurrency = {}; const debtsByCurrency = {}; const serviceCounts = {};
  activeData.forEach(r => { const curr = r.currency || "DZD"; const price = parseFloat(r.price) || 0; 
    if(r.paymentStatus === 'unpaid') { debtsByCurrency[curr] = (debtsByCurrency[curr] || 0) + price; } else if(r.paymentStatus === 'partial') { const paid = parseFloat(r.paidAmount) || 0; totalsByCurrency[curr] = (totalsByCurrency[curr] || 0) + paid; debtsByCurrency[curr] = (debtsByCurrency[curr] || 0) + (price - paid); } else { totalsByCurrency[curr] = (totalsByCurrency[curr] || 0) + price; }
    const srv = r.serviceType || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"; serviceCounts[srv] = (serviceCounts[srv] || 0) + 1; 
  });
  let totalsHtml = ""; if (Object.keys(totalsByCurrency).length === 0) { totalsHtml = `<div style="color:var(--accent); font-size:32px; margin-bottom:10px;">0 <span style="font-size:18px; color:var(--muted);">DZD</span></div>`; } else { for (let curr in totalsByCurrency) { totalsHtml += `<div style="color:var(--accent); font-size:32px; margin-bottom:5px;">${totalsByCurrency[curr].toLocaleString()} <span style="font-size:18px; color:var(--muted);">${curr}</span></div>`; } }
  let debtsHtml = ""; if (Object.keys(debtsByCurrency).length > 0) { debtsHtml = `<div style="margin-top:10px; padding:10px; background:rgba(239,68,68,0.1); border-radius:12px; border:1px solid rgba(239,68,68,0.3);"><div style="color:#ef4444; font-size:12px; font-weight:bold; margin-bottom:5px;">â— Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© (ØºÙŠØ± Ø§Ù„Ù…Ø­ØµÙ„Ø©):</div>`; for (let curr in debtsByCurrency) { debtsHtml += `<div style="color:#ef4444; font-size:16px; font-weight:900;">${debtsByCurrency[curr].toLocaleString()} ${curr}</div>`; } debtsHtml += `</div>`; }
  let servicesHtml = `<div style="margin-top:15px; display:flex; flex-wrap:wrap; gap:5px; justify-content:center; padding-top:15px; border-top:1px solid rgba(255,255,255,0.1);">`; for(let s in serviceCounts) { servicesHtml += `<span class="statChip" style="font-size:11px; background:rgba(124,92,255,0.1); border-color:rgba(124,92,255,0.3); color:#eaf0ff;">${s}: ${serviceCounts[s]}</span>`; } servicesHtml += `</div>`;
  $("totalsBody").innerHTML = `${totalsHtml}<div style="font-size:13px; color:var(--muted);">Ø§Ù„Ù…Ø¯Ø§Ø®ÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠØ© Ø§Ù„Ù…Ø­ØµÙ„Ø© Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„ÙØ¹Ù‘Ø§Ù„Ø©.</div>${debtsHtml}${servicesHtml}`; openModal("totalsModal"); 
};

$("openBackup").onclick = () => { closeModal("toolsModal"); openModal("backupModal"); };
$("openSync").onclick = () => { closeModal("toolsModal"); openModal("syncModal"); };
$("exportJsonBtn").onclick = () => { if(data.length === 0) return showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª", "warn"); const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data)); const a = document.createElement("a"); a.href = dataStr; a.download = `Backup_${todayISO()}.json`; a.click(); closeModal("toolsModal"); showToast("ØªÙ… Ø§Ù„ØªÙ†Ø²ÙŠÙ„ ğŸ“¥"); };
$("importFileBtn").onclick = () => $("fileInput").click();
$("fileInput").onchange = (e) => { const file = e.target.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = async (event) => { try { const imported = JSON.parse(event.target.result); if(Array.isArray(imported)) { data = imported; await firebasePush(); render(); closeModal("backupModal"); closeModal("toolsModal"); showToast("ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ âœ…"); } } catch(err) { showToast("Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­", "err"); } }; reader.readAsText(file); };
$("confirmPasteBtn").onclick = async () => { try { const imported = JSON.parse($("pasteArea").value); if(Array.isArray(imported)) { data = imported; await firebasePush(); render(); closeModal("pasteModal"); closeModal("backupModal"); closeModal("toolsModal"); $("pasteArea").value=""; showToast("ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ âœ…"); } } catch(e) { showToast("ÙƒÙˆØ¯ ØºÙŠØ± ØµØ§Ù„Ø­", "err"); } };
$("printBtn").onclick = () => { closeModal("toolsModal"); window.print(); };
$("clearBtn").onclick = async () => { if(confirm("âš ï¸ ØªØ­Ø°ÙŠØ± Ø®Ø·ÙŠØ±: Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!")) { logAction("ØªØµÙÙŠØ± Ø§Ù„Ù„ÙˆØ­Ø©", "Ø­Ø°Ù ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âš ï¸"); lastDeletedData = [...data]; data = []; await firebasePush(); render(); closeModal("toolsModal"); showToast("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ğŸ—‘ï¸ (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Øª)"); } };
$("shareBtn").onclick = () => { closeModal("toolsModal"); if (navigator.share) { navigator.share({ title: 'Ù„ÙˆØ­Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª', url: window.location.href }); } else { showToast("Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©", "warn"); } };

$("authLogin").onclick = () => { auth.signInWithEmailAndPassword($("authEmail").value, $("authPass").value).catch(e => showToast("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø®Ø§Ø·Ø¦Ø©", "err")); };
$("authLogout").onclick = () => auth.signOut();
$("openAuth").onclick = () => openModal("authModal");
$("search").oninput = render;
if($("clearSearchBtn")) { $("clearSearchBtn").onclick = () => { $("search").value = ""; render(); }; }
if($("pasteSearchBtn")) { $("pasteSearchBtn").onclick = async () => { try { const text = await navigator.clipboard.readText(); $("search").value = text; render(); } catch(e) { showToast("ÙØ´Ù„ Ø§Ù„Ù„ØµÙ‚ØŒ ÙŠØ±Ø¬Ù‰ Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø§ÙØ¸Ø©", "warn"); } }; }

function openModal(id){ $(id).setAttribute("aria-hidden","false"); }
function closeModal(id){ $(id).setAttribute("aria-hidden","true"); }
function showToast(m, type="ok"){ const t=$("toast"); t.textContent=m; t.style.borderColor = type==="err"?"#ef4444":"#22c55e"; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"), 3000); }
document.querySelectorAll(".filterBtn").forEach(b => { b.onclick = (e) => { document.querySelectorAll(".filterBtn").forEach(x=>x.classList.remove("active")); e.target.classList.add("active"); currentFilter = e.target.dataset.filter; render(); }; });

</script>
</body>
</html>
