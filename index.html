<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>ููุญุฉ ุชุณููุฑ ุงูุงุดุชุฑุงูุงุช - v12.9.19</title>

<meta name="theme-color" content="#070a12" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="ุงูุงุดุชุฑุงูุงุช" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<style>
:root{
  --bg0:#070a12; --bg1:#0b1020; --card: rgba(255,255,255,.06); --line: rgba(255,255,255,.10);
  --text:#eaf0ff; --muted: rgba(234,240,255,.70); --accent:#7c5cff; --warn:#f59e0b;
  --err:#ef4444; --radius:18px; --shadow: 0 18px 45px rgba(0,0,0,.45);
}

*{box-sizing:border-box}
body{
  margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; color: var(--text);
  background: radial-gradient(1200px 650px at 85% -10%, rgba(124,92,255,.25), transparent 60%), linear-gradient(180deg, var(--bg0), var(--bg1));
  padding: 18px; -webkit-user-select: none; user-select: none; overflow-x: hidden;
}
input, textarea, table, select { -webkit-user-select: auto; user-select: auto; }

.container{max-width:1200px;margin:0 auto}

.header{margin-bottom:14px}
.header h1{margin:0;font-size:20px; display: flex; align-items: center; gap: 8px;}
.header .sub{margin-top:6px;font-size:13px;color:var(--muted);line-height:1.7}
.version-badge { background: linear-gradient(135deg, var(--accent), #5a3bc2); color: white; padding: 4px 8px; border-radius: 8px; font-weight: 900; font-size: 12px; box-shadow: 0 4px 15px rgba(124,92,255,0.3);}

.card{ background: var(--card); border: 1px solid var(--line); border-radius: var(--radius); box-shadow: var(--shadow); backdrop-filter: blur(10px); overflow:hidden; }

.topbar{ padding:14px; border-bottom:1px solid var(--line); display:flex; flex-direction:column; gap:12px; }
.topbar-actions { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; width: 100%; justify-content: flex-start; }
.searchWrap{ display: flex; gap: 6px; align-items: center; width: 100%; }
.searchWrap input { flex:1; width:100%; padding:10px 12px; border-radius:14px; border:1px solid var(--line); background: rgba(0,0,0,.18); color: var(--text); outline:none; transition: all 0.2s; font-size: 14px;}
.searchWrap input:focus { border-color: rgba(124,92,255,.6); box-shadow: 0 0 0 4px rgba(124,92,255,.14); }

.btn{ border:1px solid var(--line); background: rgba(0,0,0,.18); color: var(--text); padding:10px 12px; border-radius:14px; font-weight:900; cursor:pointer; transition: all .15s ease; font-size:13px; white-space: nowrap; }
.btn:hover{ background: rgba(255,255,255,.06); }
.btn:active{ transform: scale(.98); }
.btn.primary{ border-color: rgba(124,92,255,.55); background: linear-gradient(135deg, rgba(124,92,255,.55), rgba(124,92,255,.15)); }
.btn.danger{ border-color: rgba(239,68,68,.45); background: linear-gradient(135deg, rgba(239,68,68,.35), rgba(239,68,68,.12)); color: #ff8a8a; }
.btn.soft{ border-color: rgba(255,255,255,.14); background: rgba(255,255,255,.04); }
.btn-close { padding: 8px 14px; font-size: 13px; border-radius: 12px; }

input:-webkit-autofill { -webkit-box-shadow: 0 0 0 30px #161b2a inset !important; -webkit-text-fill-color: var(--text) !important; }

.filtersBar{ width: 100%; display: flex; gap: 8px; padding: 10px 14px; flex-wrap: wrap; border-bottom: 1px solid var(--line); background: rgba(0,0,0,0.1); }
.filterBtn{ padding: 6px 12px; border-radius: 999px; border: 1px solid var(--line); background: rgba(0,0,0,.18); color: var(--muted); font-size: 12px; font-weight: 800; cursor: pointer; }
.filterBtn.active{ background: var(--text); color: var(--bg0); border-color: var(--text); }

.bulkBar{ display: none; align-items: center; gap: 10px; padding: 12px 14px; background: rgba(124,92,255,.15); border-bottom: 1px solid rgba(124,92,255,.3); flex-wrap: wrap; }
.bulkBar .selCount{ font-weight: 900; color: #fff; background: var(--accent); padding: 4px 10px; border-radius: 99px; font-size: 12px; }

.statChip{ display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; border:1px solid var(--line); background: rgba(0,0,0,.18); font-size:12px; font-weight:900; color: var(--text); margin-inline-start: auto; }
.statChip.sync{ border-color: rgba(124,92,255,.45); background: rgba(124,92,255,.10); }

input[type="checkbox"] { appearance: none; width: 18px; height: 18px; border: 2px solid var(--muted); border-radius: 4px; background: rgba(0,0,0,.2); cursor: pointer; position: relative; display: inline-block; vertical-align: middle; }
input[type="checkbox"]:checked { background: var(--accent); border-color: var(--accent); }
input[type="checkbox"]:checked::after { content: "โ"; position: absolute; color: white; font-size: 12px; left: 3px; top: -1px; font-weight: bold; }

/* ๐ ุงูุฌุฏูู ุงูููุงุณููู ุงูููู ูุงููุณุชูุฑ - ุฎุงูู ูู ุฃุฎุทุงุก ุงูููุจุงูู ๐ */
.tableWrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
table { width: 100%; border-collapse: collapse; min-width: 850px; }
thead th { position: sticky; top: 0; z-index: 5; background: rgba(0,0,0,0.3); color: var(--muted); text-align: right; font-size: 12px; font-weight: 900; padding: 12px 10px; border-bottom: 1px solid var(--line); white-space: nowrap; }
tbody tr { transition: background 0.2s; }
tbody tr:hover { background: rgba(255,255,255,0.02); }
tbody td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); vertical-align: middle; white-space: nowrap; }

tr.expired-row{ background: rgba(239,68,68,.08); }
tr.expiring-row{ background: rgba(245,158,11,.06); }

.badge{ display:inline-flex; align-items:center; padding:4px 8px; border-radius:999px; border:1px solid var(--line); font-size:11px; font-weight:900; }
.badge.ok{ border-color: rgba(34,197,94,.45); color:#c8f7d9; background: rgba(34,197,94,.1); }
.badge.warn{ border-color: rgba(245,158,11,.45); color:#ffe2b3; background: rgba(245,158,11,.1); }
.badge.err{ border-color: rgba(239,68,68,.45); color:#ffd0d0; background: rgba(239,68,68,.1); }

.service-badge { background: rgba(124,92,255,0.15); color: #a78bfa; padding: 4px 8px; border-radius: 6px; font-weight: bold; font-size: 11px; border: 1px solid rgba(124,92,255,0.3); display: inline-block; }
.tag-pill { background: rgba(255,255,255,0.05); color: var(--muted); border: 1px solid rgba(255,255,255,0.15); padding: 2px 6px; border-radius: 6px; font-size: 10px; margin-inline-end: 4px; display: inline-block; margin-top: 4px;}

.modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,.75); z-index:9999; padding: 18px; }
.modal[aria-hidden="false"]{ display:flex; }
.modal .box{ width:min(500px, 100%); background: rgba(10,14,26,.96); border: 1px solid rgba(255,255,255,.10); border-radius: 22px; box-shadow: 0 30px 90px rgba(0,0,0,.65); max-height: 90vh; overflow-y: auto; }
.modalHeader{ padding:16px 20px; border-bottom:1px solid rgba(255,255,255,.10); display:flex; align-items:center; justify-content:space-between; gap:10px; position: sticky; top: 0; background: rgba(10,14,26,.96); z-index: 10; }
.modalHeader h2{margin:0;font-size:18px}
.modalBody{ padding: 20px; }
.modalFooter{ padding:16px 20px; border-top:1px solid rgba(255,255,255,.10); display:flex; gap:10px; flex-wrap:wrap; position: sticky; bottom: 0; background: rgba(10,14,26,.96); z-index: 10; }

.formGrid{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px; }
.full-width { grid-column: 1 / -1 !important; }
@media (max-width: 768px){ .formGrid{ grid-template-columns: 1fr; } }

.field label{ display:block; font-weight:900; font-size:13px; color: var(--muted); margin-bottom:8px; }
.field input, .field select, .field textarea { background: rgba(0,0,0,.3); border:1px solid rgba(255,255,255,.15); width:100%; padding:12px 14px; border-radius:14px; color: var(--text); outline:none; transition: all 0.2s; font-size: 14px; font-family:inherit; resize:vertical; }
.field input:focus, .field select:focus, .field textarea:focus { border-color: rgba(124,92,255,.6); box-shadow: 0 0 0 4px rgba(124,92,255,.14); background:rgba(0,0,0,0.5); }

.actGrid{ display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:12px; }
@media (max-width: 640px){ .actGrid{ grid-template-columns: 1fr; } }
.actBtn{ border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); color: var(--text); padding: 14px; border-radius: 18px; font-weight: 900; cursor:pointer; text-align: right; width: 100%; }
.actBtn:disabled { opacity: 0.4; cursor: not-allowed; }

.actionPill { padding: 8px 16px; border-radius: 10px; background: linear-gradient(135deg, var(--accent), #5a3bc2); color: white; font-weight: 900; border: none; cursor: pointer; font-size: 13px; box-shadow: 0 4px 15px rgba(124,92,255,0.3); white-space: nowrap; transition: all 0.2s; }
.actionPill:active { transform: scale(0.95); }

.toast{ position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%) translateY(20px); padding: 12px 14px; border-radius: 16px; background: rgba(10,14,26,.92); border: 1px solid rgba(255,255,255,.12); color: var(--text); display: flex; align-items: center; gap: 10px; opacity: 0; pointer-events: none; transition: all .2s ease; z-index: 10000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); font-weight:bold; }
.toast.show{ opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto;}

.auth-wrap { text-align: center; padding: 10px 15px; }
.auth-icon-wrap { display:inline-flex; align-items:center; justify-content:center; width:75px; height:75px; background:linear-gradient(135deg, rgba(124,92,255,0.2), rgba(124,92,255,0.05)); border:1px solid rgba(124,92,255,0.3); border-radius:50%; font-size:32px; margin-bottom:15px; box-shadow: 0 10px 25px rgba(124,92,255,0.15); }
.auth-title { margin:0 0 5px 0; font-size:24px; color:var(--text); font-weight:900; }
.auth-sub { color:var(--muted); font-size:13px; margin-bottom: 30px; }
.auth-input { width:100%; padding:15px 18px; background:rgba(0,0,0,0.4); border:1px solid rgba(255,255,255,0.1); border-radius:16px; color:#fff; font-size:15px; outline:none; transition:all 0.2s; text-align: left; direction: ltr; }

@media print {
  body.print-mode-receipt > *:not(#receiptModal) { display: none !important; }
  body.print-mode-idcard > *:not(#idCardModal) { display: none !important; }
  body { background: white !important; padding: 0 !important; margin: 0 !important; }
  .modal.print-active { display: block !important; position: static !important; background: white !important; }
  .modal.print-active .box { width: 100% !important; max-width: none !important; box-shadow: none !important; border: none !important; border-radius: 0 !important; padding: 0 !important; margin: 0 !important; }
  .no-print { display: none !important; }
}

.pagination { display: flex; justify-content: center; align-items: center; gap: 12px; padding: 16px; border-top: 1px solid var(--line); background: rgba(0,0,0,0.1); }
.page-btn { padding: 8px 16px; border-radius: 12px; border: 1px solid var(--line); background: rgba(255,255,255,.05); color: var(--text); cursor: pointer; transition: all 0.2s; font-size: 13px; font-weight: bold; }
.page-btn:hover:not(:disabled) { background: var(--accent); border-color: var(--accent); }
.page-btn:disabled { opacity: 0.4; cursor: not-allowed; background: transparent; }
.page-info { font-size: 13px; color: var(--muted); font-weight: bold; background: rgba(0,0,0,0.2); padding: 8px 14px; border-radius: 10px; }

.id-card-wrap { border: 2px solid #e2e8f0; border-radius: 16px; padding: 25px; background: linear-gradient(135deg, #ffffff, #f1f5f9); position: relative; overflow: hidden; color: #0f172a; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
.id-card-wrap::before { content: ""; position: absolute; top: 0; left: 0; right: 0; height: 6px; background: linear-gradient(90deg, var(--accent), #4ade80); }

.side-menu {
  position: fixed; top: 0; right: -320px; width: 300px; height: 100vh;
  background: rgba(10,14,26,.98); border-left: 1px solid rgba(255,255,255,.1);
  box-shadow: -10px 0 50px rgba(0,0,0,0.8); z-index: 10001;
  transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex; flex-direction: column; padding: 20px;
  backdrop-filter: blur(15px);
}
.side-menu.open { right: 0; }
.menu-backdrop {
  position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 10000;
  opacity: 0; pointer-events: none; transition: opacity 0.3s ease; backdrop-filter: blur(3px);
}
.menu-backdrop.open { opacity: 1; pointer-events: auto; }
.side-menu-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,.1); padding-bottom: 15px; margin-bottom: 20px; }
.side-menu-header h2 { margin: 0; font-size: 18px; color: var(--text); }
.menu-section-title { font-size: 12px; color: var(--accent); font-weight: bold; margin: 25px 0 10px; padding-inline-start: 5px; }
.side-menu .actBtn { margin-bottom: 8px; font-size: 13px; padding: 12px 14px; }

/* ุงููุงุชูุฑุฉ ุงููุฑูุฉ - ูุณุชูุฑุฉ ุชูุงูุงู */
.flex-row-receipt { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px dashed #cbd5e1; flex-wrap: wrap; gap: 5px;}
.flex-row-receipt span.label { color: #64748b; }
.flex-row-receipt strong.val, .flex-row-receipt span.val { color: #0f172a; text-align: left; }
</style>

<script>
// ๐ ุงูุณุญุฑ ุงูุชููู: ุงุณุชูุดุงู ูุง ุฅุฐุง ูุงู ุงูุฒุงุฆุฑ "ุนูููุงู" ุฃู "ูุฏูุฑุงู" ๐
const _urlParams = new URLSearchParams(window.location.search);
const _portalData = _urlParams.get('p');

if (_portalData) {
    // ==========================================
    // ๐ ูุถุน ุจูุงุจุฉ ุงูุนููู (Client Portal Mode) ๐
    // ==========================================
    window.onload = () => {
        try {
            // ูู ุงูุชุดููุฑ ุนู ุงูุฑุงุจุท
            const jsonStr = decodeURIComponent(escape(atob(_portalData)));
            const d = JSON.parse(jsonStr);
            
            // ุชุฏููุฑ ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ ูุจูุงุก ูุงุฌูุฉ ุจุทุงูุฉ ุงูุนููู ุงููุฎูุฉ
            document.body.innerHTML = `
            <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; background: radial-gradient(circle at 50% -20%, #7c5cff30, transparent 60%), #070a12; font-family: system-ui, -apple-system, sans-serif; direction: rtl;">
                <div style="width: 100%; max-width: 400px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 24px; padding: 35px 25px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); backdrop-filter: blur(20px);">
                    <div style="font-size: 50px; margin-bottom: 10px; filter: drop-shadow(0 10px 15px rgba(124,92,255,0.3));">๐ค</div>
                    <h2 style="color: #eaf0ff; margin: 0 0 5px 0; font-size: 22px; font-weight: 900;">${d.sn}</h2>
                    <div style="color: rgba(234,240,255,0.5); font-size: 13px; margin-bottom: 30px; letter-spacing: 1px;">ุจูุงุจุฉ ุงููุดุชุฑู ุงูุฑูููุฉ</div>

                    <h1 style="color: white; font-size: 28px; margin: 0 0 10px 0; font-weight: 900;">${d.n}</h1>
                    <div style="display: inline-block; background: rgba(124,92,255,0.15); color: #c4b5fd; padding: 6px 16px; border-radius: 99px; font-weight: bold; font-size: 14px; border: 1px solid rgba(124,92,255,0.3); margin-bottom: 30px;">${d.srv}</div>

                    <div style="background: rgba(0,0,0,0.3); border-radius: 18px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.03); text-align: right;">
                        <div style="color: rgba(234,240,255,0.5); font-size: 13px; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;"><span>๐</span> ุชูุงุตูู ุงูุงุดุชุฑุงู:</div>
                        ${d.ty === 'sessions'
                            ? `<div style="font-size: 16px; color: white; font-weight: bold;">ูุชุจูู <span style="color: #10b981; font-size: 26px; font-weight: 900; margin: 0 4px;">${d.sl}</span> ูู ${d.st} ุญุตุฉ</div>`
                            : `<div style="font-size: 15px; color: white; font-weight: bold; line-height: 1.8;">ุงูุจุฏุงูุฉ: <span style="color:#eaf0ff;">${d.sd}</span><br>ุงูุงูุชูุงุก: <span style="color:#ef4444; font-size:18px;">${d.ed}</span></div>`
                        }
                    </div>

                    <div style="background: ${d.db > 0 ? 'rgba(239,68,68,0.1)' : 'rgba(16,185,129,0.1)'}; border-radius: 18px; padding: 20px; border: 1px solid ${d.db > 0 ? 'rgba(239,68,68,0.2)' : 'rgba(16,185,129,0.2)'}; text-align: right;">
                        <div style="color: ${d.db > 0 ? '#fca5a5' : '#6ee7b7'}; font-size: 13px; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;"><span>๐ณ</span> ุงููุถุนูุฉ ุงููุงููุฉ:</div>
                        <div style="font-size: 18px; color: ${d.db > 0 ? '#ef4444' : '#10b981'}; font-weight: bold;">
                            ${d.db > 0 ? `ูุชุจูู ููุฏูุน: <span style="font-size: 24px; font-weight: 900;">${d.db}</span> ${d.cr}` : 'ุฎุงูุต ุจุงููุงูู ๐ข'}
                        </div>
                    </div>

                    <div style="margin-top: 35px; font-size: 11px; color: rgba(234,240,255,0.2);">Powered by Subscription Manager v12.9.19</div>
                </div>
            </div>
            `;
        } catch(e) {
            document.body.innerHTML = `<div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: #070a12;"><div style="text-align:center; padding:50px; color:#ef4444; background: rgba(239,68,68,0.1); border-radius:20px; border: 1px solid rgba(239,68,68,0.3);">โ<br><br>ุนุฐุฑุงูุ ุงูุฑุงุจุท ุชุงูู ุฃู ุบูุฑ ุตุงูุญ.</div></div>`;
        }
    };
} else {
    // ==========================================
    // โ๏ธ ูุถุน ุงูุฅุฏุงุฑุฉ (Admin Dashboard Mode) โ๏ธ
    // ==========================================
    // (ููุท ุฅุฐุง ูู ููู ููุงู ุฑุงุจุท ููุนูููุ ุณูุชู ุชุดุบูู ููุฏ ุงูููุญุฉ ุจุงููุงูู ุฃุฏูุงู)
}
</script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>
<div class="container" id="adminAppContainer">
  <div class="header">
    <h1>๐งพ ููุญุฉ ุชุณููุฑ ุงูุงุดุชุฑุงูุงุช <span class="version-badge">v12.9.19 PWA</span></h1>
    <div class="sub">โก ุงููุณุฎุฉ ุงูุฐูุจูุฉ ุงููุจุฑู: ุชู ุฏูุฌ ุจูุงุจุฉ ุงูุนููู ุงูุฐููุฉ ูุงูุฌุฏูู ุงูููุงุณููู.</div>
  </div>

  <div class="card">
    <div class="topbar">
      <div class="topbar-actions">
        <button class="btn soft" type="button" onclick="openSideMenu()" title="ุงูุฅุนุฏุงุฏุงุช ูุงูุฃุฏูุงุช" style="padding: 10px 14px; font-size: 18px; border-color: rgba(255,255,255,0.2);">โฐ</button>
        <button class="btn primary" type="button" onclick="openAddSub()">โ ุฅุถุงูุฉ ุนููู</button>
        <button class="btn primary" type="button" onclick="openScannerModal()" style="background: linear-gradient(135deg, #10b981, #059669); border-color: #059669;">๐ท ูุณุญ ุจุทุงูุฉ</button>
        <button class="btn soft" type="button" onclick="openModal('packagesModal')" style="border-color:#a855f7; color:#c084fc; background: rgba(168,85,247,0.15); font-weight: 900;">๐ฆ ุงูุจุงูุงุช</button>
        <button class="btn soft" type="button" onclick="openTotalsReport()">๐ฐ ุงูุฅุญุตุงุฆูุงุช</button>
        <div class="statChip sync" id="syncChip"><span class="ico">โ๏ธ</span> <span class="v" id="syncVal">โ</span></div>
      </div>
      <div class="searchWrap">
        <input id="search" oninput="window.debounceSearch()" placeholder="ุจุญุซ ุจุงูุงุณูุ ุงูุฅููููุ ุงููุณุงูุ ุงููุงุชู..." />
        <button class="btn soft" title="ูุตู ุงูุจุญุซ" style="padding: 10px 12px; border-radius: 12px; font-size: 15px;" onclick="window.pasteSearch()">๐</button>
        <button class="btn soft" title="ูุณุญ ุงูุจุญุซ" style="padding: 10px 12px; border-radius: 12px; color: var(--err);" onclick="window.clearSearch()">โ</button>
      </div>
    </div>

    <div class="bulkBar" id="bulkBar">
      <div class="selCount" id="selCount">0 ูุญุฏุฏ</div>
      <button class="btn" style="border-color:#10b981; color:#10b981; background: rgba(16,185,129,0.1);" onclick="openBulkWhatsAppModal()">๐ฌ ุฑุณุงุฆู ุฌูุงุนูุฉ</button>
      <button class="btn" style="border-color:var(--accent); color:var(--accent);" onclick="bulkExtendAction()">๐ ุชุฌุฏูุฏ</button>
      <button class="btn danger" onclick="bulkDeleteAction()">๐๏ธ ุญุฐู</button>
      <button class="btn soft" style="margin-inline-start:auto;" onclick="clearSelectionAction()">ุฅูุบุงุก ุงูุชุญุฏูุฏ</button>
    </div>

    <div class="filtersBar" id="filtersBar">
      <button class="filterBtn active" data-filter="all" onclick="setFilter(this, 'all')">ุงููู</button>
      <button class="filterBtn" data-filter="active" onclick="setFilter(this, 'active')">โ ูุนูุงู (ุฒููู/ุญุตุต)</button>
      <button class="filterBtn" data-filter="expiring" onclick="setFilter(this, 'expiring')">โฐ ูุฑูุจ ููุชูู</button>
      <button class="filterBtn" data-filter="expired" onclick="setFilter(this, 'expired')">โ ููุชูู ุงูุฑุตูุฏ/ุงููุฏุฉ</button>
    </div>

    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th style="width: 40px; text-align: center;"><input type="checkbox" id="selectAll" onchange="toggleSelectAll(this)"></th>
            <th>ุงูุนููู ูุงูุฃูุณูุฉ</th> <th>ุงููุงุชู</th> <th>ุงูุงุดุชุฑุงู</th> <th>ุงููุงููุฉ</th> <th>ุงูุชูุงุฑูุฎ / ุงูุฑุตูุฏ</th> <th>ุงูุญุงูุฉ</th> <th>ุฅุฌุฑุงุก</th>
          </tr>
        </thead>
        <tbody id="tbody">
           </tbody>
      </table>
    </div>
    <div id="paginationControls" class="pagination"></div>
  </div>
</div>

<div class="menu-backdrop" id="menuBackdrop" onclick="closeSideMenu()"></div>
<div class="side-menu" id="sideMenu">
  <div class="side-menu-header">
    <h2>โ๏ธ ุฃุฏูุงุช ูุฅุนุฏุงุฏุงุช</h2>
    <button class="btn danger btn-close" onclick="closeSideMenu()" style="padding: 6px 12px;">โ</button>
  </div>
  <div style="flex:1; overflow-y:auto; padding-right: 5px;">
    
    <div class="menu-section-title">ุฅุตูุงุญ ูุญู ุงููุดุงูู</div>
    <button class="actBtn" style="color:#60a5fa; border-color:rgba(96,165,250,0.4); background:rgba(96,165,250,0.1);" onclick="window.location.reload(true)">๐ ุชูุฑูุบ ุงูุฐุงูุฑุฉ ูุชุญุฏูุซ ุงูุตูุญุฉ</button>

    <div class="menu-section-title">ุฅุฏุงุฑุฉ ุงููุธุงู</div>
    <button class="actBtn" onclick="closeSideMenu(); openModal('authModal')" style="border-color:var(--accent); color:var(--accent); background: rgba(124,92,255,0.1);">๐ค ุฅุฏุงุฑุฉ ุงูุญุณุงุจุงุช ูุงูุตูุงุญูุงุช</button>
    
    <div class="menu-section-title">ุงูุจูุงูุงุช ูุงูุญูุงูุฉ</div>
    <button class="actBtn" style="color:#10b981; border-color:rgba(16,185,129,0.4); background:rgba(16,185,129,0.1);" onclick="closeSideMenu(); window.exportCSV()">๐ฅ ุชุญููู ูููู Excel</button>
    <button class="actBtn" onclick="closeSideMenu(); openModal('backupModal')">๐ฆ ุญูุธ ูุงุณุชุฑุฌุงุน ุงูุจูุงูุงุช</button>
    <button class="actBtn" onclick="closeSideMenu(); openModal('syncModal')">โ๏ธ ุงููุฒุงููุฉ ุงูุณุญุงุจูุฉ</button>
    
    <div class="menu-section-title">ุฃุฏูุงุช ุฅุถุงููุฉ</div>
    <button class="actBtn" style="color:#f59e0b; border-color:rgba(245,158,11,0.4); background:rgba(245,158,11,0.1);" onclick="closeSideMenu(); window.undoDelete()">โฉ๏ธ ุงูุชุฑุงุฌุน ุนู ุขุฎุฑ ุญุฐู</button>
    <button class="actBtn" onclick="closeSideMenu(); window.shareApp()">๐ค ูุดุงุฑูุฉ ุฑุงุจุท ุงูููุญุฉ</button>
    <button class="actBtn" onclick="closeSideMenu(); window.print()">๐จ๏ธ ุทุจุงุนุฉ ุงูุฌุฏูู</button>
    
    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(239,68,68,0.2);">
      <button class="actBtn danger" onclick="closeSideMenu(); window.clearAllData()" style="text-align: center;">โ๏ธ ุชุตููุฑ ุงูููุญุฉ ุจุงููุงูู</button>
    </div>
  </div>
</div>

<div class="modal" id="formModal" aria-hidden="true">
  <div class="box" role="dialog" aria-modal="true" style="width:min(600px, 100%)">
    <div class="modalHeader"><div><h2 id="formTitle">ุฅุถุงูุฉ ุงุดุชุฑุงู</h2><div class="hint">ุงููุฃ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ุซู ุงุถุบุท ุญูุธ</div></div><button class="btn danger btn-close" type="button" onclick="closeModal('formModal')">โ ุฅุบูุงู</button></div>
    <div class="modalBody">
      <div class="formGrid">
        <div class="field full-width" style="background:rgba(124,92,255,0.08); padding:12px 14px; border-radius:14px; border:1px dashed rgba(124,92,255,0.3); margin-bottom:5px;">
          <label style="color:#c4b5fd; margin-bottom:8px;">๐ฆ ุงุฎุชุตุงุฑ: ุงุฎุชุฑ ุจุงูุฉ ุฌุงูุฒุฉ (ุงุฎุชูุงุฑู)</label>
          <div style="display:flex; gap:8px;">
            <select id="packageSelector" onchange="window.applyPackage()" style="background:rgba(0,0,0,0.5); border-color:rgba(124,92,255,0.4); cursor:pointer; flex:1;">
              <option value="">โ๏ธ ูุง ุฃุฑูุฏ ุจุงูุฉุ ุณุฃูุชุจ ุงูุจูุงูุงุช ุจููุณู</option>
            </select>
            <button class="btn primary" type="button" style="padding:0 16px; border-radius:12px; font-size:16px;" onclick="openModal('packagesModal')" title="ุฅูุดุงุก ุจุงูุฉ ุฌุฏูุฏุฉ ุงูุขู">โ</button>
          </div>
        </div>

        <div class="field full-width"><label>ุงูุงุณู <span style="color:var(--err)">*</span></label><input id="name" placeholder="ูุซุงู: ุฃุญูุฏ ูุญูุฏ"></div>
        <div class="field full-width"><label>ุงููุงุชู (ูุน ุงูุฑูุฒ)</label><div style="display: flex; gap: 8px;"><select id="countryCode" style="width: 110px; direction: ltr;"><option value="+213">๐ฉ๐ฟ +213</option><option value="+212">๐ฒ๐ฆ +212</option><option value="+216">๐น๐ณ +216</option><option value="">ุจุฏูู ุฑูุฒ</option></select><input id="phone" type="tel" dir="ltr" placeholder="555000000" style="flex:1;"></div></div>
        <div class="field full-width" style="margin-top: 5px;">
          <label>ุงูุฎุฏูุฉ / ุงูุจุฑูุงูุฌ <span style="color:var(--err)">*</span></label>
          <input id="serviceType" list="serviceList" placeholder="ุงูุชุจ ุงูุฎุฏูุฉ (ูุซุงู: ุฑูุงุถูุงุช)">
          <datalist id="serviceList"><option value="ุฏุฑูุณ ุฏุนู"><option value="ูุงุฏู ุฑูุงุถู"><option value="ููู ูุฏุฑุณู"></datalist>
        </div>
        <div class="field full-width" style="margin-top: 5px; padding-top: 10px; border-top: 1px dashed rgba(255,255,255,0.1);">
          <label>ุทุจูุนุฉ ุงูุงุดุชุฑุงู ูููููุฉ ุงูุญุณุงุจ <span style="color:var(--err)">*</span></label>
          <select id="subType" onchange="window.toggleSubType()" style="background:rgba(0,0,0,0.5); border:1px solid #10b981; color:#10b981; font-weight:bold;">
            <option value="time">โณ ุงุดุชุฑุงู ุฒููู (ุฃุดูุฑ / ุชุงุฑูุฎ)</option>
            <option value="sessions">๐๏ธ ุงุดุชุฑุงู ุจุงูุญุตุต (ุฑุตูุฏ ุฏุฎูู)</option>
          </select>
        </div>
        <div id="timeFieldsGrp" style="display:contents;">
          <div class="field full-width" style="display: flex; gap:10px; background: rgba(16,185,129,0.05); padding: 12px; border-radius: 12px; border: 1px solid rgba(16,185,129,0.2);">
            <div style="flex:1;"><label>ุงููุฏุฉ (ุฃุดูุฑ)</label><input id="months" type="number" min="1" step="1" style="background: rgba(0,0,0,0.6);"></div>
            <div style="flex:1;"><label>ุชุงุฑูุฎ ุงูุจุฏุงูุฉ</label><input id="start" type="date" style="background: rgba(0,0,0,0.6);"></div>
            <div style="flex:1;"><label>ุงุฎุชูุงุฑ ุณุฑูุน</label><select id="quickPlan" onchange="window.handleQuickPlan()" style="background: rgba(0,0,0,0.6);"><option value="">โ ุงุฎุชุฑ โ</option><option value="1">1 ุดูุฑ</option><option value="3">3 ุฃุดูุฑ</option><option value="6">6 ุฃุดูุฑ</option><option value="12">12 ุดูุฑ</option></select></div>
          </div>
        </div>
        <div id="sessionsFieldsGrp" style="display:none;">
          <div class="field full-width" style="display: flex; gap:10px; background: rgba(16,185,129,0.05); padding: 12px; border-radius: 12px; border: 1px solid rgba(16,185,129,0.2);">
            <div style="flex:1;"><label>ุฅุฌูุงูู ุนุฏุฏ ุงูุญุตุต</label><input id="sessionsTotal" type="number" min="1" step="1" placeholder="ูุซุงู: 12" style="background: rgba(0,0,0,0.6);"></div>
            <div style="flex:1;"><label>ุงูุฑุตูุฏ ุงููุชุจูู (ููุชุนุฏูู ููุท)</label><input id="sessionsLeft" type="number" min="0" step="1" style="color:var(--warn); font-weight:bold; background: rgba(0,0,0,0.6);"></div>
          </div>
        </div>
        <div class="field full-width" style="display:flex; gap:10px; margin-top:5px;">
           <div style="flex:1;"><label>ุงูุณุนุฑ ุงูุฅุฌูุงูู</label><input id="price" type="number" min="0" step="0.01" placeholder="5000" oninput="window.calcDebt()"></div>
           <div style="flex:1;"><label>ุงููุฏููุน <span style="font-size:10px; font-weight:normal;">(ูุงุฑุบ = ุฏูุน ุงููู)</span></label><input id="paidAmount" type="number" min="0" step="0.01" oninput="window.calcDebt()" title="ููุตู ุจุงุณุชุฎุฏุงู ุฒุฑ ุงูุฏูุนุงุช ูู ุงูุฅุฌุฑุงุกุงุช ูุชุณุฏูุฏ ุงูุฏููู"></div>
        </div>
        <div class="field full-width"><label>ุงูุฏูู ุงููุชุจูู (ุขูู)</label><input id="debtAmount" type="text" readonly style="background: rgba(239,68,68,0.1); color: #ff8a8a; font-weight: bold; border-color: rgba(239,68,68,0.3); pointer-events: none;"></div>
        <div class="full-width" style="margin-top: 10px;">
          <button type="button" id="btnToggleAdvanced" class="btn soft" style="width: 100%; border-style: dashed; color: var(--muted); padding: 12px;" onclick="window.toggleAdvancedFields()">
            ๐ฝ ุฅุธูุงุฑ ุงูุฎูุงุฑุงุช ุงูุฅุถุงููุฉ (ุงูุฅููููุ ุงูููุงุญุธุงุชุ ุงูุฃูุณูุฉุ ุงูููุณูุฌุฑ...)
          </button>
        </div>
        <div id="advancedFields" class="full-width" style="display: none; background: rgba(0,0,0,0.2); padding: 16px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.05); margin-top: 10px;">
          <div class="formGrid">
            <div class="field full-width"><label>๐ ุฑุงุจุท ุงููุญุงุฏุซุฉ (ููุณูุฌุฑ / ุงูุณุชุบุฑุงู / ููุจ)</label><input id="messengerLink" type="url" dir="ltr" placeholder="https://..." title="ุงูุณุฎ ุฑุงุจุท ุญุณุงุจ ุงูุฒุจูู ุฃู ุฑุงุจุท ุงููุญุงุฏุซุฉ ูุงูุตูู ููุง"></div>
            
            <div class="field full-width"><label>ุงูุฅูููู (ุงุฎุชูุงุฑู)</label><input id="email" placeholder="ูุซุงู: name@example.com" inputmode="email"></div>
            <div class="field full-width"><label>ุงูุฃูุณูุฉ / ุงูุชุตูููุงุช (ููุตููุฉ ุจูุงุตูุฉ)</label><input id="tags" placeholder="ูุซุงู: ุณูุฉ 4 ูุชูุณุท, ููุฌ ุงูุฃุญุฏ, VIP..."></div>
            <div class="field"><label>ุชูุจูู ูุจู (ุฃูุงู)</label><input id="alertDays" type="number" min="1" step="1" value="7"></div>
            <div class="field full-width"><label>ุงูุนููุฉ</label><select id="currency"><option value="DZD">DZD</option><option value="EUR">EUR</option><option value="USD">USD</option><option value="MAD">MAD</option><option value="TND">TND</option></select></div>
            <div class="field full-width"><label>ููุงุญุธุงุช ุฎุงุตุฉ (ูุง ุชุธูุฑ ููุนููู)</label><textarea id="notes" rows="2" placeholder="ุฃุฑูุงู ุณุฑูุฉุ ููุงุญุธุงุช ุฎุงุตุฉ..."></textarea></div>
          </div>
        </div>
      </div>
    </div>
    <div class="modalFooter"><button class="btn primary" type="button" style="width:100%; padding: 16px; font-size: 16px; font-weight:bold; border-radius:14px; box-shadow: 0 8px 25px rgba(124,92,255,0.2);" onclick="window.saveSubscription()">๐พ ุญูุธ ุจูุงูุงุช ุงููุดุชุฑู</button></div>
  </div>
</div>

<div class="modal" id="scannerModal" aria-hidden="true">
  <div class="box" style="width: min(400px, 100%)">
    <div class="modalHeader">
      <h2>๐ท ูุณุญ ุจุทุงูุฉ ุงูุงูุฎุฑุงุท</h2>
      <button class="btn danger btn-close" type="button" onclick="closeScannerModal()">โ ุฅุบูุงู</button>
    </div>
    <div class="modalBody" style="text-align: center;">
      <div id="qr-reader" style="width:100%; border-radius: 12px; overflow: hidden; border: 1px solid var(--line); background: #fff;"></div>
      <div id="qr-reader-results" style="margin-top: 15px; font-weight: bold; color: var(--warn);">ูุฌูู ุงููุงููุฑุง ูุญู ุงูู QR Code...</div>
    </div>
  </div>
</div>

<div class="modal" id="checkInModal" aria-hidden="true">
  <div class="box" style="width: min(400px, 100%); text-align:center;">
    <div class="modalHeader" style="justify-content:center;"><h2>๐ ููุทุฉ ุงูุฏุฎูู (Check-in)</h2></div>
    <div class="modalBody" style="padding: 30px 20px;">
      <h3 id="chkInName" style="font-size:26px; margin:0 0 10px 0; color:var(--text);">ุงูุงุณู</h3>
      <div id="chkInService" style="color:var(--muted); font-size: 15px; margin-bottom:20px;">ุงูุฎุฏูุฉ</div>
      <div style="margin-bottom:25px;"><span id="chkInStatus" class="badge" style="font-size: 14px; padding: 8px 16px;">ุงูุญุงูุฉ</span></div>
      <div id="chkInAlert" style="font-weight:bold; font-size:18px; margin-bottom:25px; padding: 15px; border-radius: 12px; background: rgba(255,255,255,0.05);"></div>
      <button class="btn primary" id="btnChkInAction" style="width:100%; padding:16px; font-size:16px; font-weight:bold; margin-bottom:15px; border-radius:14px;"></button>
      <div style="display:flex; gap:10px;">
        <button class="btn soft" style="flex:1; padding: 12px;" onclick="closeModal('checkInModal'); window.openRowActions(currentRowId)">โ๏ธ ุฅุฏุงุฑุฉ ุงููุดุชุฑู</button>
        <button class="btn danger" style="flex:1; padding: 12px;" onclick="closeModal('checkInModal')">ุฅุบูุงู ุงููุงูุฐุฉ</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="packagesModal" aria-hidden="true">
  <div class="box" style="width: min(600px, 100%)">
    <div class="modalHeader"><h2>๐ฆ ุงูุจุงูุงุช ุงูุฌุงูุฒุฉ</h2><button class="btn danger btn-close" type="button" onclick="closeModal('packagesModal')">โ ุฅุบูุงู</button></div>
    <div class="modalBody">
      <div class="formGrid" style="margin-bottom: 20px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
        <div class="field full-width"><label>ุงุณู ุงูุจุงูุฉ ุงูุฏูุงูู</label><input id="pkgName" placeholder="ูุซุงู: ุจุงูุฉ ููุฒูุงุก - 4 ูุชูุณุท"></div>
        <div class="field full-width"><label>ููุน ุงูุฎุฏูุฉ</label><input id="pkgService" placeholder="ูุซุงู: ุฏุฑูุณ ุฏุนู ููุฒูุงุก"></div>
        <div class="field"><label>ุงูููุน</label><select id="pkgType"><option value="time">ุฒููู (ุฃุดูุฑ)</option><option value="sessions">ุฑุตูุฏ (ุญุตุต)</option></select></div>
        <div class="field"><label>ุงููููุฉ (ูุฏุฉ ุฃู ุญุตุต)</label><input id="pkgValue" type="number" min="1" placeholder="ูุซุงู: 12"></div>
        <div class="field"><label>ุงูุณุนุฑ ุงูุงูุชุฑุงุถู</label><input id="pkgPrice" type="number" min="0" placeholder="15000"></div>
        <div class="field full-width" style="display:flex; gap:10px;">
          <button id="btnSavePackage" class="btn primary" style="flex:1; padding:12px; border-radius:12px; text-align: center;" onclick="window.savePackage()">โ ุญูุธ ุงูุจุงูุฉ</button>
          <button id="btnCancelPkgEdit" class="btn soft" style="display:none; padding:12px; border-radius:12px; text-align: center; color:var(--err);" onclick="window.cancelEditPackage()">โ ุฅูุบุงุก ุงูุชุนุฏูู</button>
        </div>
      </div>
      <div style="max-height: 250px; overflow: auto; border: 1px solid var(--line); border-radius: 12px;">
        <table style="min-width: 100%; font-size: 13px;">
          <thead style="background: rgba(0,0,0,0.4);"><tr><th>ุงุณู ุงูุจุงูุฉ ูุงูุฎุฏูุฉ</th><th>ุงูููุน/ุงููููุฉ</th><th>ุงูุณุนุฑ</th><th>ุฅุฌุฑุงุก</th></tr></thead>
          <tbody id="packagesTbody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="storeSettingsModal" aria-hidden="true">
  <div class="box" style="width: min(400px, 100%)">
    <div class="modalHeader"><h2>โ๏ธ ุฅุนุฏุงุฏุงุช ุงููุชุฌุฑ (ุงูููุฌู)</h2><button class="btn danger btn-close" type="button" onclick="closeModal('storeSettingsModal')">โ ุฅุบูุงู</button></div>
    <div class="modalBody">
       <div class="field" style="margin-bottom:15px"><label>ุงุณู ุงููุคุณุณุฉ / ุงููุชุฌุฑ</label><input id="setStoreName" placeholder="ูุซุงู: ูุคุณุณุฉ ุงููุฌุงุญ"></div>
       <div class="field" style="margin-bottom:15px"><label>ุงูุดุนุงุฑ (Logo)</label><input type="file" id="setStoreLogo" accept="image/*" style="padding: 8px;" onchange="window.handleLogoUpload(event)"></div>
       <div style="text-align:center; padding:10px; background:rgba(255,255,255,0.05); border-radius:12px;"><div style="font-size:12px; color:var(--muted); margin-bottom:5px;">ูุนุงููุฉ ุงูุดุนุงุฑ:</div><img id="logoPreview" src="" style="max-width:100px; max-height:100px; border-radius:10px; display:none; margin: 0 auto;"><div id="logoEmojiFallback" style="font-size:40px;">๐</div></div>
       <button class="btn primary" style="width:100%; margin-top:20px; padding:14px; border-radius:14px; text-align: center;" onclick="window.saveStoreSettings()">๐พ ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
    </div>
  </div>
</div>

<div class="modal" id="receiptModal" aria-hidden="true">
  <div class="box" style="width: min(450px, 100%); background: #ffffff; color: #000000; border: none; border-radius: 12px;">
    <div class="modalHeader no-print" style="background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
      <h2 style="color: #0f172a;">๐ ุงููุตู ุงูุฑููู</h2>
      <button class="btn btn-close" type="button" style="background:#f1f5f9; color:#ef4444; border:1px solid #e2e8f0;" onclick="closeModal('receiptModal')">โ ุฅุบูุงู</button>
    </div>
    <div class="modalBody receipt-content" style="padding: 30px 25px; font-family: Tahoma, Arial, sans-serif; background: #ffffff;">
      <div style="text-align: center; margin-bottom: 25px;">
        <img id="receiptLogoImg" src="" style="display:none; max-width:80px; max-height:80px; border-radius:12px; margin:0 auto 10px;">
        <div id="receiptLogoEmoji" style="font-size: 40px; margin-bottom: 5px;">๐</div>
        <h1 id="receiptStoreName" style="margin: 0; font-size: 24px; color: #4f46e5; font-weight: 900;">ุงููุคุณุณุฉ</h1>
        <div style="color: #64748b; font-size: 13px; margin-top: 5px;">ูุงุชูุฑุฉ ุงุดุชุฑุงู ุฅููุชุฑูููุฉ</div>
      </div>
      
      <div style="font-size: 15px;">
        <div class="flex-row-receipt"><span class="label">ุงุณู ุงูุนููู:</span><strong class="val" id="recName"></strong></div>
        <div class="flex-row-receipt"><span class="label">ุฑูู ุงููุงุชู:</span><span class="val" style="direction: ltr;" id="recPhone"></span></div>
        <div class="flex-row-receipt"><span class="label">ููุน ุงูุฎุฏูุฉ:</span><strong class="val" style="color: #8b5cf6;" id="recService"></strong></div>
        
        <div id="recRowMonths" class="flex-row-receipt" style="display:none;"><span class="label">ูุฏุฉ ุงูุงุดุชุฑุงู:</span><span class="val" id="recMonths"></span></div>
        <div id="recRowSessions" class="flex-row-receipt" style="display:none;"><span class="label">ุฑุตูุฏ ุงูุญุตุต:</span><strong class="val" id="recSessions"></strong></div>
        <div id="recRowStart" class="flex-row-receipt" style="display:none;"><span class="label">ุชุงุฑูุฎ ุงูุจุฏุงูุฉ:</span><span class="val" id="recStart"></span></div>
        <div id="recRowEnd" class="flex-row-receipt" style="display:none; border-bottom: 1px solid #cbd5e1;"><span class="label">ุชุงุฑูุฎ ุงูุงูุชูุงุก:</span><span class="val" id="recEnd"></span></div>

        <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px 0 10px 0;">
          <span style="color: #0f172a; font-size: 18px; font-weight: 900;">ุงูุณุนุฑ ุงูุฅุฌูุงูู:</span>
          <strong style="color: #10b981; font-size: 20px;" id="recPrice"></strong>
        </div>

        <div class="flex-row-receipt" style="padding: 10px 0;"><span class="label">ุญุงูุฉ ุงูุฏูุน:</span><strong class="val" id="recPaymentStatus"></strong></div>
        <div id="recPaidAmountRow" class="flex-row-receipt" style="display:none; padding: 10px 0;"><span class="label">ุฅุฌูุงูู ุงููุฏููุน:</span><strong class="val" style="color: #3b82f6;" id="recPaidAmount"></strong></div>
        <div id="recRemainingRow" style="display:none; justify-content: space-between; background:#fef2f2; border-bottom: 1px dashed #cbd5e1; padding: 12px 5px; border-radius: 8px;">
          <span style="color: #ef4444; font-weight:bold;">โ ุงููุจูุบ ุงููุชุจูู (ุฏูู):</span><strong style="color: #ef4444; font-size: 16px;" id="recRemaining"></strong>
        </div>
      </div>
      
      <div id="receiptPaymentLogSection" style="display:none; margin-top: 15px; border-top: 1px dashed #cbd5e1; padding-top: 15px;">
         <div style="font-size: 12px; color: #64748b; margin-bottom: 8px; font-weight: bold;">ุณุฌู ุงูุฏูุนุงุช ุจุงูุชูุตูู:</div>
         <div id="receiptPaymentLogList"></div>
      </div>

      <div style="text-align: center; margin-top: 35px; font-size: 12px; color: #94a3b8; line-height: 1.6;">ูุดูุฑูู ุนูู ุซูุชูู ุจูุง ๐ค<br><span style="font-size: 10px;">ุชู ุงูุฅุตุฏุงุฑ ุจุชุงุฑูุฎ <span id="recToday"></span></span></div>
    </div>
    <div class="modalFooter no-print" style="background: #f8fafc; border-top: 1px solid #e2e8f0; border-radius: 0 0 12px 12px; display:flex; gap:10px;">
      <button class="btn primary" style="flex:1; padding: 14px; font-size: 14px; border-radius: 12px; background: #4f46e5; border-color: #4338ca; text-align: center;" onclick="window.printReceiptAction()">๐จ๏ธ ุทุจุงุนุฉ ุฃู PDF</button>
      <button class="btn primary" style="flex:1; padding: 14px; font-size: 14px; border-radius: 12px; background: #22c55e; border-color: #16a34a; text-align: center;" onclick="window.sendWhatsAppReceipt()">๐ฌ ุฅุฑุณุงู ูุงุชุณุงุจ</button>
    </div>
  </div>
</div>

<div class="modal" id="idCardModal" aria-hidden="true">
  <div class="box" style="width: min(420px, 100%); background: #ffffff; color: #000000; border: none; border-radius: 16px;">
    <div class="modalHeader no-print" style="background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
      <h2 style="color: #0f172a;">๐ชช ุจุทุงูุฉ ุงูุงูุฎุฑุงุท</h2>
      <button class="btn btn-close" type="button" style="background:#f1f5f9; color:#ef4444; border:1px solid #e2e8f0;" onclick="closeModal('idCardModal')">โ ุฅุบูุงู</button>
    </div>
    <div class="modalBody id-card-content" style="padding: 25px; font-family: Tahoma, Arial, sans-serif; background: #ffffff; display: flex; justify-content: center;">
      <div class="id-card-wrap" style="width: 100%; max-width: 350px;">
        <h2 id="idCardStoreName" style="margin: 0 0 5px 0; color: #4f46e5; font-size: 22px;">ุงููุคุณุณุฉ</h2>
        <div style="font-size: 11px; color: #94a3b8; margin-bottom: 20px; letter-spacing: 1px;">ุจุทุงูุฉ ุนุถููุฉ ุฑูููุฉ - MEMBERSHIP CARD</div>
        <div style="display: flex; justify-content: center; margin-bottom: 20px;">
          <div id="idCardQR" style="padding: 10px; background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; display: inline-block;"></div>
        </div>
        <h3 id="idCardClientName" style="margin: 0 0 5px 0; font-size: 24px; font-weight: 900;">ุงูุงุณู</h3>
        <div id="idCardService" style="font-weight: bold; color: #8b5cf6; font-size: 15px; margin-bottom: 15px; background: rgba(139,92,246,0.1); display: inline-block; padding: 4px 12px; border-radius: 99px;">ุงูุฎุฏูุฉ</div>
        <div style="display: flex; justify-content: space-between; font-size: 13px; border-top: 1px dashed #cbd5e1; padding-top: 15px; text-align: right;">
           <div style="flex:1;">
             <span style="color:#64748b; display:block; font-size: 11px;">ููุน ุงูุงุดุชุฑุงู</span>
             <strong id="idCardType" style="font-size: 14px;">...</strong>
           </div>
           <div style="flex:1; text-align: left;">
             <span style="color:#64748b; display:block; font-size: 11px;">ุงูุญุงูุฉ / ุงูุฑุตูุฏ</span>
             <strong id="idCardStatus" style="font-size: 14px;">...</strong>
           </div>
        </div>
      </div>
    </div>
    <div class="modalFooter no-print" style="background: #f8fafc; border-top: 1px solid #e2e8f0; border-radius: 0 0 16px 16px;">
      <button class="btn primary" style="width: 100%; padding: 14px; font-size: 15px; border-radius: 12px; background: #0f172a; border-color: #000; text-align: center;" onclick="window.printIdCardAction()">๐จ๏ธ ุทุจุงุนุฉ ุงูุจุทุงูุฉ</button>
    </div>
  </div>
</div>

<div class="modal" id="extendModal" aria-hidden="true"><div class="box" style="width: min(350px, 100%)"><div class="modalHeader"><h2 id="extendTitle">ุชุฌุฏูุฏ ุงูุงุดุชุฑุงู</h2><button class="btn danger btn-close" type="button" onclick="closeModal('extendModal')">โ ุฅุบูุงู</button></div><div class="modalBody"><div class="field" style="margin-bottom:15px"><label id="lblExtendValue">ุงููุฏุฉ ุงููุถุงูุฉ</label><input id="extendValue" type="number" min="1" value="1"></div><div class="field" style="margin-bottom:20px" id="grpExtendUnit"><label>ุงููุญุฏุฉ</label><select id="extendUnit"><option value="months">ุฃุดูุฑ</option><option value="days">ุฃูุงู</option></select></div><button class="btn primary" style="width:100%; text-align: center;" onclick="window.confirmExtend()">ุชุฃููุฏ ุงูุชุฌุฏูุฏ</button></div></div></div>

<div class="modal" id="paymentModal" aria-hidden="true">
  <div class="box" style="width: min(450px, 100%)">
    <div class="modalHeader"><h2>๐ธ ุฅุฏุงุฑุฉ ุงูุฏูุนุงุช</h2><button class="btn danger btn-close" type="button" onclick="closeModal('paymentModal'); openModal('rowActionsModal')">ุงูุนูุฏุฉ โฉ</button></div>
    <div class="modalBody">
      <div style="margin-bottom: 15px; font-weight: bold; color: var(--text); font-size: 16px;" id="paymentClientName"></div>
      
      <div style="display: flex; justify-content: space-between; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05);">
        <div style="text-align: center;"><span style="font-size:11px; color:var(--muted); display:block;">ุงูุณุนุฑ ุงูุฅุฌูุงูู</span><strong id="payTotal" style="color:var(--text); font-size:15px;"></strong></div>
        <div style="text-align: center;"><span style="font-size:11px; color:var(--muted); display:block;">ุฅุฌูุงูู ุงููุฏููุน</span><strong id="payPaid" style="color:#10b981; font-size:15px;"></strong></div>
        <div style="text-align: center;"><span style="font-size:11px; color:var(--muted); display:block;">ุงููุชุจูู (ุฏูู)</span><strong id="payDebt" style="color:#ef4444; font-size:15px;"></strong></div>
      </div>

      <div id="newPaymentWrap">
         <div class="field" style="display:flex; gap:10px; margin-bottom:15px;">
            <input id="newPaymentAmount" type="number" min="1" step="0.01" placeholder="ุฃุฏุฎู ูุจูุบ ุงูุฏูุนุฉ ุงูุฌุฏูุฏุฉ..." style="flex:1;">
            <button class="btn primary" onclick="window.confirmNewPayment()" style="background: #10b981; border-color: #059669;">โ ุชุณุฏูุฏ</button>
         </div>
      </div>

      <div style="font-size:12px; color:var(--accent); margin-bottom:8px; font-weight:bold;">ุณุฌู ุงูุฏูุนุงุช ุงูุณุงุจูุฉ:</div>
      <div style="max-height: 200px; overflow: auto; background: rgba(0,0,0,0.3); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
        <table style="width: 100%; font-size: 13px; border-collapse: collapse;">
          <thead style="background: rgba(255,255,255,0.05);"><tr><th style="padding: 10px; text-align: right; color: var(--muted);">ุงูุชุงุฑูุฎ ูุงูููุช</th><th style="padding: 10px; text-align: left; color: var(--muted);">ุงูุฏูุนุฉ ุงููุงููุฉ</th></tr></thead>
          <tbody id="paymentTbody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="attendanceModal" aria-hidden="true">
  <div class="box" style="width: min(450px, 100%)">
    <div class="modalHeader"><h2>๐ ุณุฌู ุงูุญุถูุฑ ูุงูุฏุฎูู</h2><button class="btn danger btn-close" type="button" onclick="closeModal('attendanceModal'); openModal('rowActionsModal')">ุงูุนูุฏุฉ โฉ</button></div>
    <div class="modalBody">
      <div style="margin-bottom: 15px; font-weight: bold; color: var(--accent); font-size: 18px;" id="attendanceClientName"></div>
      <div style="max-height: 300px; overflow: auto; background: rgba(0,0,0,0.3); border-radius: 14px; border: 1px solid rgba(255,255,255,0.1);">
        <table style="width: 100%; font-size: 13px;">
          <thead style="background: rgba(255,255,255,0.05);"><tr><th style="padding: 10px;">#</th><th style="padding: 10px; text-align: right;">ุงูุชุงุฑูุฎ</th><th style="padding: 10px; text-align: left;">ุงูููุช</th></tr></thead>
          <tbody id="attendanceTbody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="rowActionsModal" aria-hidden="true">
  <div class="box" role="dialog" aria-modal="true" style="width: min(400px, 100%)">
    <div class="modalHeader">
      <div><h2 style="font-size: 16px;">โก ุฅุฌุฑุงุกุงุช ุงููุดุชุฑู</h2><div class="hint" id="rowActionsHint" style="color: var(--accent); font-weight: bold; font-size: 14px;">โ</div></div>
      <button class="btn danger btn-close" type="button" onclick="closeModal('rowActionsModal')" style="padding: 6px 12px;">โ</button>
    </div>
    
    <div class="modalBody" style="padding: 20px;">
      
      <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px;">
        <button class="btn primary" style="padding: 14px; font-size: 15px; font-weight: bold; box-shadow: 0 4px 15px rgba(124,92,255,0.2);" onclick="window.actExtendAction()">
          ๐ ุชุฌุฏูุฏ ุงูุงุดุชุฑุงู (ุฑุตูุฏ / ูุฏุฉ)
        </button>
        <button class="btn" style="padding: 14px; font-size: 15px; font-weight: bold; color: #fff; background: linear-gradient(135deg, #3b82f6, #2563eb); border-color: #2563eb; box-shadow: 0 4px 15px rgba(59,130,246,0.2);" onclick="window.openMembershipCard()">
          ๐ชช ุนุฑุถ ุจุทุงูุฉ ุงูุงูุฎุฑุงุท (QR)
        </button>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
        <button class="btn soft" style="color: #4ade80; border-color: rgba(37,211,102,.3); background: rgba(37,211,102,.1);" onclick="window.actWhatsAppAction()">
          ๐ฌ ูุงุชุณุงุจ
        </button>
        <button class="btn soft" id="btnMessengerAction" style="color: #0ea5e9; border-color: rgba(14,165,233,.3); background: rgba(14,165,233,.1);" onclick="window.actMessengerAction()">
          ๐ฌ ููุณูุฌุฑ / ุงูุณุชุง
        </button>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
        <button class="btn soft" style="color: #f43f5e; border-color: rgba(244,63,94,.3); background: rgba(244,63,94,.1);" onclick="window.actSMSAction()">
          ๐ฑ ุฑุณุงูุฉ SMS
        </button>
        <button class="btn soft" style="color: #60a5fa; border-color: rgba(96,165,250,.3); background: rgba(96,165,250,.1);" onclick="window.openReceiptAction()">
          ๐ ุฅุตุฏุงุฑ ูุงุชูุฑุฉ
        </button>
      </div>

      <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; padding-top: 15px; border-top: 1px dashed rgba(255,255,255,0.1);">
        <button class="btn soft" style="font-size: 12px; padding: 8px 14px; border-radius: 10px;" onclick="window.actEditAction()">โ๏ธ ุชุนุฏูู</button>
        <button class="btn soft" id="btnViewNotes" style="font-size: 12px; padding: 8px 14px; border-radius: 10px; color: #a855f7; border-color: rgba(168,85,247,.3);" onclick="window.openNotesAction()">๐ ุงูููุงุญุธุงุช</button>
        <button class="btn soft" style="font-size: 12px; padding: 8px 14px; border-radius: 10px;" onclick="window.actCopyEmailAction()">๐ ูุณุฎ Email</button>
        <button class="btn soft" id="btnViewAttendance" style="font-size: 12px; padding: 8px 14px; border-radius: 10px; color: #10b981; border-color: rgba(16,185,129,.3);" onclick="window.openAttendanceLog()">๐ ุณุฌู ุงูุญุถูุฑ</button>
        <button class="btn soft" style="font-size: 12px; padding: 8px 14px; border-radius: 10px; color: #fbbf24; border-color: rgba(251,191,36,.3);" onclick="window.openPaymentModal()">๐ธ ุงูุฏูุนุงุช ูุงูุฏููู</button>
        <button class="btn soft" style="font-size: 12px; padding: 8px 14px; border-radius: 10px; color: #c084fc; border-color: rgba(192,132,252,.3); width: 100%;" onclick="window.copyPortalLink()">๐ ูุณุฎ ุฑุงุจุท ุจูุงุจุฉ ุงูุนููู ุงูุฐููุฉ</button>
      </div>

      <div style="padding-top: 15px; border-top: 1px solid rgba(239,68,68,0.2);">
        <button class="btn danger" style="width: 100%; padding: 12px; border-radius: 12px; font-size: 13px;" onclick="window.actDeleteAction()">
          ๐๏ธ ุญุฐู ุงููุดุชุฑู ููุงุฆูุงู
        </button>
      </div>

    </div>
  </div>
</div>

<div class="modal" id="viewNotesModal" aria-hidden="true">
  <div class="box" style="width: min(400px, 100%)">
    <div class="modalHeader"><h2>๐ ููุงุญุธุงุช ุงูุนููู</h2><button class="btn danger btn-close" type="button" onclick="closeModal('viewNotesModal'); openModal('rowActionsModal')">ุงูุนูุฏุฉ โฉ</button></div>
    <div class="modalBody">
      <div id="viewNotesContent" style="white-space: pre-wrap; line-height: 1.6; color: var(--text); background: rgba(0,0,0,0.3); padding: 18px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.1); font-size:14px; min-height:80px;"></div>
    </div>
  </div>
</div>

<div class="modal" id="bulkWhatsAppModal" aria-hidden="true">
  <div class="box" style="width: min(450px, 100%)">
    <div class="modalHeader">
      <h2>๐ฌ ุฑุณุงุฆู ูุงุชุณุงุจ ุงูุฌูุงุนูุฉ</h2>
      <button class="btn danger btn-close" type="button" onclick="closeModal('bulkWhatsAppModal')">โ ุฅุบูุงู</button>
    </div>
    <div class="modalBody">
      <div style="margin-bottom:15px; background:rgba(34,197,94,0.1); border:1px solid rgba(34,197,94,0.3); padding:12px; border-radius:12px; color:#c8f7d9; font-size:13px; line-height:1.5;">
        ุณูุชู ุนุฑุถ ุงููุดุชุฑููู ูุงุญุฏุงู ุชูู ุงูุขุฎุฑ ูุชุชููู ูู ุฅุฑุณุงู ุงูุฑุณุงุฆู ุจุดูู ุขูู.
        <div style="margin-top:8px; border-top:1px dashed rgba(34,197,94,0.3); padding-top:8px;">
          <b>ุนุฏุฏ ุงููุณุชูููู:</b> <span id="bulkWaCount" style="font-weight:bold; font-size:16px;">0</span> ูุดุชุฑู (ูููููู ุฃุฑูุงู)
        </div>
      </div>
      <div class="field" style="margin-bottom:15px">
        <label>ูุต ุงูุฑุณุงูุฉ (ุชุชุบูุฑ ุชููุงุฆูุงู ููู ุนููู)</label>
        <div style="font-size:11px; color:var(--muted); margin-bottom:8px; direction:ltr; text-align:right;">
          ุงููุชุบูุฑุงุช ุงููุชุงุญุฉ: <code style="background:rgba(255,255,255,0.1); padding:2px 4px; border-radius:4px;">{name}</code> , <code style="background:rgba(255,255,255,0.1); padding:2px 4px; border-radius:4px;">{end}</code> , <code style="background:rgba(255,255,255,0.1); padding:2px 4px; border-radius:4px;">{service}</code>
        </div>
        <textarea id="bulkWaMsg" rows="4">ูุฑุญุจุงู {name}ุ ููุฏ ุชุฐููุฑู ุจุงูุชูุงุก ุงุดุชุฑุงูู / ุฑุตูุฏู ูู {service}. ูุฑุฌู ุงูุชุฌุฏูุฏ ูุชูุงุฏู ุงูุงููุทุงุน.</textarea>
      </div>
      <div style="text-align:center; padding:15px 0; background:rgba(0,0,0,0.2); border-radius:12px; border:1px solid rgba(255,255,255,0.05);">
        <div id="bulkWaCurrentTarget" style="font-weight:bold; font-size:15px; margin-bottom:12px; color:var(--text);">ุงูุนููู ุงูุชุงูู: -</div>
        <button class="btn primary" id="btnSendNextWa" style="width:90%; padding:14px; font-size:15px; background:#22c55e; border-color:#16a34a; box-shadow: 0 8px 25px rgba(34,197,94,0.2); text-align: center;" onclick="window.sendNextBulkWhatsApp()">ุฅุฑุณุงู ุงูุฑุณุงูุฉ ๐</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="authModal" aria-hidden="true">
  <div class="box" style="width: min(420px, 100%); padding:0;">
    <div class="modalHeader" style="border-bottom:none; padding-bottom:0;"><button class="btn danger btn-close" type="button" id="closeAuthBtn" onclick="closeModal('authModal')" style="display:none; margin-inline-start:auto;">โ ุฅุบูุงู</button></div>
    <div class="modalBody" style="padding-top:0;">
      <div id="authLoginSection" class="auth-wrap"><div class="auth-icon-wrap">๐</div><h2 class="auth-title">ุชุณุฌูู ุงูุฏุฎูู</h2><div class="auth-sub">ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ูููุตูู ุฅูู ููุญุฉ ุงูุชุญูู</div><div style="margin-bottom:20px;"><label class="auth-label">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label><input id="authEmailAuth" type="email" class="auth-input" placeholder="admin@example.com"></div><div style="margin-bottom:30px;"><label class="auth-label">ูููุฉ ุงููุฑูุฑ</label><input id="authPass" type="password" class="auth-input" placeholder="โขโขโขโขโขโขโขโข"></div><button class="btn primary" style="width:100%; padding:16px; font-size:16px; font-weight:900; border-radius:16px; box-shadow: 0 8px 25px rgba(124,92,255,0.3); text-align: center;" onclick="window.loginUser()">ุฏุฎูู ๐</button></div>
      <div id="authLoggedInSection" style="display:none; padding:10px;">
        <div style="text-align:center; margin-bottom:25px;"><div id="authStatusIcon" class="auth-icon-wrap" style="background:linear-gradient(135deg, rgba(34,197,94,0.2), rgba(34,197,94,0.05)); border-color:rgba(34,197,94,0.3); box-shadow: 0 10px 25px rgba(34,197,94,0.15);">โ</div><div id="authStateText" style="font-weight:900; font-size:15px; line-height:1.6;"></div></div>
        <div id="ownerDashboard" style="display:none; padding:20px; background:rgba(124,92,255,0.08); border-radius:18px; border:1px solid rgba(124,92,255,0.2); margin-bottom:25px;"><h3 style="margin-top:0; color:#fff; font-size:15px; display:flex; align-items:center; gap:8px;">๐ ุฃุฏูุงุช ุงููุงูู (Owner)</h3><button class="btn soft" onclick="closeModal('authModal'); openModal('storeSettingsModal')" style="width:100%; margin-bottom:12px; padding:12px; border-radius:12px; border-color:rgba(16,185,129,0.3); color:#10b981; text-align: center;">โ๏ธ ุฅุนุฏุงุฏุงุช ุงููุชุฌุฑ (ุงูุงุณู ูุงูููุฌู)</button><button class="btn primary" onclick="closeModal('authModal'); openModal('addAdminModal')" style="width:100%; margin-bottom:12px; padding:12px; border-radius:12px; text-align: center;">โ ุฅูุดุงุก ุญุณุงุจ ูุณุชุฎุฏู ุฌุฏูุฏ</button><button class="btn soft" onclick="closeModal('authModal'); window.loadAdminsList()" style="width:100%; padding:12px; border-radius:12px; border-color:rgba(255,255,255,0.1); text-align: center;">๐ฅ ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช ูููุณุชุฎุฏููู</button><button class="btn soft" onclick="closeModal('authModal'); window.openAuditLog()" style="width:100%; padding:12px; border-radius:12px; border-color:rgba(245,158,11,0.3); color:#f59e0b; margin-top:12px; text-align: center;">๐ต๏ธโโ๏ธ ุณุฌู ูุดุงุทุงุช ุงููุฏุฑุงุก</button></div>
        <button class="btn danger" style="width:100%; padding:14px; border-radius:14px; font-size:15px; text-align: center;" onclick="window.logoutUser()">ุชุณุฌูู ุงูุฎุฑูุฌ ุงููุขูู</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="addAdminModal" aria-hidden="true"><div class="box" style="width: min(380px, 100%)"><div class="modalHeader"><h2>โ ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ</h2><button class="btn danger btn-close" type="button" onclick="closeModal('addAdminModal')">โ ุฅุบูุงู</button></div><div class="modalBody"><div class="field" style="margin-bottom:15px"><label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label><input id="newAdminEmail" type="email"></div><div class="field" style="margin-bottom:15px"><label>ูููุฉ ุงููุฑูุฑ (6 ุฃุญุฑู ุฃู ุฃูุซุฑ)</label><input id="newAdminPass" type="password"></div><div class="field" style="margin-bottom:25px"><label>ููุน ุงูุตูุงุญูุฉ</label><select id="newAdminRole"><option value="admin">ุฃุฏูู</option><option value="owner">ูุงูู ๐</option></select></div><button class="btn primary" style="width:100%; padding:12px; text-align: center;" onclick="window.confirmAddAdmin()">ุชุฃููุฏ ูุฅูุดุงุก ุงูุญุณุงุจ</button></div></div></div>
<div class="modal" id="manageAdminsModal" aria-hidden="true"><div class="box" style="width: min(500px, 100%)"><div class="modalHeader"><h2>๐ฅ ูุงุฆูุฉ ุงููุณุชุฎุฏููู</h2><button class="btn danger btn-close" type="button" onclick="closeModal('manageAdminsModal')">โ ุฅุบูุงู</button></div><div class="modalBody"><div style="font-size:12px; color:var(--warn); margin-bottom:15px; padding:10px; background:rgba(245,158,11,0.1); border-radius:10px; border:1px solid rgba(245,158,11,0.3);"><b>ููุงุญุธุฉ ูุงูุฉ:</b> ุณุญุจ ุงูุตูุงุญูุฉ ูููุน ุงููุณุชุฎุฏู ูู ุงูุฏุฎูู ูููุญุฉ.</div><div style="max-height:300px; overflow:auto;"><table style="min-width:100%;"><thead><tr><th>ุงูุฅูููู</th><th>ุงูุตูุงุญูุฉ</th><th>ุฅุฌุฑุงุก</th></tr></thead><tbody id="adminsTbody"></tbody></table></div></div></div></div>

<div class="modal" id="auditLogModal" aria-hidden="true">
  <div class="box" style="width: min(700px, 100%)">
    <div class="modalHeader">
      <h2>๐ต๏ธโโ๏ธ ุณุฌู ูุดุงุทุงุช ุงููุฏุฑุงุก</h2>
      <div style="display:flex; gap:10px;"><button class="btn danger" id="deleteSelectedLogsBtn" style="display:none; padding:8px 12px; font-size:12px;" onclick="window.deleteSelectedLogs()">๐๏ธ ุญุฐู ุงููุญุฏุฏ</button><button class="btn danger btn-close" type="button" onclick="closeModal('auditLogModal')">โ ุฅุบูุงู</button></div>
    </div>
    <div class="modalBody">
      <div style="max-height:400px; overflow:auto; border:1px solid rgba(255,255,255,0.1); border-radius:12px;">
        <table style="min-width:100%; font-size: 13px;">
          <thead style="background: rgba(0,0,0,0.4);"><tr><th style="width: 40px; text-align: center;"><input type="checkbox" id="selectAllLogs" onchange="window.toggleAllLogs(event)"></th><th>ุงูููุช ูุงูุชุงุฑูุฎ</th><th>ุงููุณุชุฎุฏู (ุงูุฃุฏูู)</th><th>ููุน ุงูุฅุฌุฑุงุก</th><th>ุงูุชูุงุตูู</th></tr></thead>
          <tbody id="auditTbody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="backupModal" aria-hidden="true"><div class="box" style="width:min(400px, 100%)"><div class="modalHeader"><h2>๐ฆ ุงููุณุฎ ุงูุงุญุชูุงุทู (JSON)</h2><button class="btn danger btn-close" type="button" onclick="closeModal('backupModal')">โ ุฅุบูุงู</button></div><div class="modalBody"><div style="display:grid; gap:10px;"><button class="btn soft" onclick="window.exportJson()" style="text-align: center;">โฌ๏ธ ุชุตุฏูุฑ ูุณุฎุฉ JSON</button><button class="btn soft" onclick="window.importFile()" style="text-align: center;">โฌ๏ธ ุงุณุชูุฑุงุฏ ูุณุฎุฉ JSON</button><input id="fileInput" type="file" accept=".json" style="display:none" onchange="window.handleFileSelect(event)"><button class="btn soft" onclick="closeModal('backupModal'); openModal('pasteModal')" style="text-align: center;">๐ ุงุณุชูุฑุงุฏ ุจุงููุตู</button></div></div></div></div>
<div class="modal" id="pasteModal" aria-hidden="true"><div class="box"><div class="modalHeader"><h2>๐ ุงุณุชูุฑุงุฏ ุจุงููุตู</h2><button class="btn danger btn-close" type="button" onclick="closeModal('pasteModal')">โ ุฅุบูุงู</button></div><div class="modalBody"><textarea id="pasteArea" rows="10" style="width:100%; background:rgba(0,0,0,0.3); color:white; border:1px solid rgba(255,255,255,0.1); padding:10px; border-radius:10px; outline:none;"></textarea></div><div class="modalFooter"><button class="btn primary" style="text-align: center;" onclick="window.confirmPaste()">ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช</button></div></div></div>
<div class="modal" id="syncModal" aria-hidden="true"><div class="box"><div class="modalHeader"><h2>โ๏ธ ุงููุฒุงููุฉ ูุงููุณุฎ ุงูุงุญุชูุงุทู</h2><button class="btn danger btn-close" type="button" onclick="closeModal('syncModal')">โ ุฅุบูุงู</button></div><div class="modalBody">ููุฒุฉ ุงููุฒุงููุฉ ุชุนูู ูู ุงูุฎูููุฉ ูุญุธูุงู ูุจุดูู ุชููุงุฆู โ</div></div></div>
<div class="modal" id="totalsModal" aria-hidden="true"><div class="box" style="width:min(400px, 100%)"><div class="modalHeader"><h2>๐ฐ ุงููุฌููุน ุงูุนุงู</h2><button class="btn danger btn-close" type="button" onclick="closeModal('totalsModal')">โ ุฅุบูุงู</button></div><div class="modalBody"><div id="totalsBody" style="text-align:center; padding: 10px 0;"></div></div></div></div>

<div id="toast" class="toast"></div>

<script>
window.copyPortalLink = () => {
    const rec = data.find(x => x.id === currentRowId);
    if(!rec) return;

    let debt = (parseFloat(rec.price)||0) - (parseFloat(rec.paidAmount)||0);
    if(debt < 0) debt = 0;

    // ุชุบููู ุจูุงูุงุช ุงูุนููู ูู ูุจุณููุฉ ุตุบูุฑุฉ ุฌุฏุงู
    const payload = {
        n: rec.name || "ุนููู",
        srv: rec.serviceType || "ุบูุฑ ูุญุฏุฏ",
        ty: rec.subType || "time",
        sl: rec.sessionsLeft || 0,
        st: rec.sessionsTotal || 0,
        sd: rec.start || "-",
        ed: rec.end || "-",
        db: debt,
        cr: rec.currency || "DZD",
        sn: storeSettings.name || "ุงููุคุณุณุฉ"
    };

    // ุชุดููุฑ ุงููุจุณููุฉ ูุชูููุฏ ุงูุฑุงุจุท ุงูููุงุฆู
    const jsonStr = JSON.stringify(payload);
    const base64 = btoa(unescape(encodeURIComponent(jsonStr)));
    const link = window.location.origin + window.location.pathname + "?p=" + base64;

    // ูุณุฎ ุงูุฑุงุจุท ุชููุงุฆูุงู
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(link).then(() => {
            showToast("ุชู ูุณุฎ ุฑุงุจุท ุงูุจูุงุจุฉ ุจูุฌุงุญ ๐");
            closeModal("rowActionsModal");
        }).catch(() => {
            prompt("ูุดู ุงููุณุฎ ุงูุชููุงุฆูุ ูู ุจูุณุฎ ุงูุฑุงุจุท ูุฏููุงู:", link);
            closeModal("rowActionsModal");
        });
    } else {
        prompt("ูุชุตูุญู ูุง ูุฏุนู ุงููุณุฎ ุงูุชููุงุฆูุ ุงูุณุฎ ุงูุฑุงุจุท ูุฏููุงู:", link);
        closeModal("rowActionsModal");
    }
};
</script>

</div> </body>
</html>
