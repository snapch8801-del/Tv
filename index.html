<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù„ÙˆØ­Ø© ØªØ³ÙŠÙŠØ± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª 2.0 (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ù†Ø¸ÙØ©)</title>

<style>
:root{
  --bg0:#070a12; --bg1:#0b1020; --card: rgba(255,255,255,.06); --line: rgba(255,255,255,.10);
  --text:#eaf0ff; --muted: rgba(234,240,255,.70); --accent:#7c5cff; --warn:#f59e0b;
  --err:#ef4444; --radius:18px; --shadow: 0 18px 45px rgba(0,0,0,.45);
}

*{box-sizing:border-box}
body{
  margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; color: var(--text);
  background: radial-gradient(1200px 650px at 85% -10%, rgba(124,92,255,.25), transparent 60%), linear-gradient(180deg, var(--bg0), var(--bg1));
  padding: 18px;
}
.container{max-width:1200px;margin:0 auto}
.header{margin-bottom:14px}
.header h1{margin:0;font-size:20px}
.header .sub{margin-top:6px;font-size:13px;color:var(--muted);line-height:1.7}

.card{ background: var(--card); border: 1px solid var(--line); border-radius: var(--radius); box-shadow: var(--shadow); backdrop-filter: blur(10px); overflow:hidden; }
.topbar{ padding:14px; border-bottom:1px solid var(--line); display:flex; align-items:center; gap:10px; flex-wrap:wrap; }

.btn{ border:1px solid var(--line); background: rgba(0,0,0,.18); color: var(--text); padding:10px 12px; border-radius:14px; font-weight:900; cursor:pointer; transition: transform .08s ease; }
.btn.primary{ border-color: rgba(124,92,255,.55); background: linear-gradient(135deg, rgba(124,92,255,.55), rgba(124,92,255,.15)); }
.btn.danger{ border-color: rgba(239,68,68,.55); background: rgba(239,68,68,.12); }

.searchWrap{flex:1;min-width:240px}
.searchWrap input{ width:100%; padding:10px 12px; border-radius:14px; border:1px solid var(--line); background: rgba(0,0,0,.18); color: var(--text); outline:none; }

.filtersBar{ width: 100%; display: flex; gap: 8px; padding: 0 14px 14px 14px; flex-wrap: wrap; border-bottom: 1px solid var(--line); }
.filterBtn{ padding: 8px 14px; border-radius: 999px; border: 1px solid var(--line); background: rgba(0,0,0,.18); color: var(--muted); font-size: 13px; font-weight: 800; cursor: pointer; }
.filterBtn.active{ background: var(--text); color: var(--bg0); border-color: var(--text); }

.statChip{ display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; border:1px solid var(--line); background: rgba(0,0,0,.18); font-size:12px; font-weight:900; color: var(--text); }
.statChip.sync{ border-color: rgba(124,92,255,.45); background: rgba(124,92,255,.10); }

.tableWrap{ overflow:auto; }
table{ width:100%; border-collapse:separate; border-spacing:0; min-width: 980px; }
thead th{ position:sticky; top:0; z-index:5; background: rgba(0,0,0,.22); color: var(--muted); text-align:right; font-size:12px; padding:12px; border-bottom:1px solid var(--line); }
tbody td{ padding:12px; border-bottom:1px solid rgba(255,255,255,.07); white-space:nowrap; }
tr.expired-row{ background: rgba(239,68,68,.10); }

.modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,.62); z-index:9999; padding: 18px; }
.modal[aria-hidden="false"]{ display:flex; }
.modal .box{ width:min(860px, 100%); background: rgba(10,14,26,.96); border: 1px solid rgba(255,255,255,.10); border-radius: 22px; }

.toast{ position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%) translateY(20px); padding: 12px 14px; border-radius: 16px; background: rgba(10,14,26,.92); border: 1px solid rgba(255,255,255,.12); color: var(--text); display: flex; align-items: center; gap: 10px; opacity: 0; transition: all .18s ease; z-index: 10000; }
.toast.show{ opacity: 1; transform: translateX(-50%) translateY(0); }

@media print{ .filtersBar, .topbar, .btn, .toast, .modal{ display:none !important; } }
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>
<div class="container">
  <div class="header">
    <h1>ğŸ§¾ Ù„ÙˆØ­Ø© ØªØ³ÙŠÙŠØ± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h1>
    <div class="sub">âš¡ Ø§Ù„Ù†Ø³Ø®Ø© 2.0: Ø§Ø³ØªÙ‚Ø±Ø§Ø± ÙƒØ§Ù…Ù„ ÙˆÙ…Ø²Ø§Ù…Ù†Ø© Ù„Ø­Ø¸ÙŠØ©</div>
  </div>

  <div class="card">
    <div class="topbar">
      <button class="btn primary" id="openAdd">â• Ø¥Ø¶Ø§ÙØ©</button>
      <button class="btn" id="openAuth">ğŸ‘¤ Ø­Ø³Ø§Ø¨</button>
      <div class="searchWrap"><input id="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…..." /></div>
      <div class="pills" id="statsBar">
        <div class="statChip sync" id="syncChip"><span class="ico">â˜ï¸</span> <span id="syncVal">â€”</span></div>
      </div>
    </div>

    <div class="filtersBar">
      <button class="filterBtn active" data-filter="all">Ø§Ù„ÙƒÙ„</button>
      <button class="filterBtn" data-filter="active">âœ… ÙØ¹Ù‘Ø§Ù„</button>
      <button class="filterBtn" data-filter="expired">âŒ Ù…Ù†ØªÙ‡ÙŠ</button>
    </div>

    <div class="tableWrap">
      <table>
        <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ù…Ø¯Ø©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<div class="modal" id="formModal" aria-hidden="true">
  <div class="box" style="padding: 20px;">
    <h3>Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ</h3>
    <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù…" style="width:100%; margin-bottom:10px; padding:10px; background:#000; color:#fff; border:1px solid #333; border-radius:10px;">
    <input id="phone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ" style="width:100%; margin-bottom:10px; padding:10px; background:#000; color:#fff; border:1px solid #333; border-radius:10px;">
    <input id="months" type="number" placeholder="Ø§Ù„Ø£Ø´Ù‡Ø±" style="width:100%; margin-bottom:10px; padding:10px; background:#000; color:#fff; border:1px solid #333; border-radius:10px;">
    <input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" style="width:100%; margin-bottom:10px; padding:10px; background:#000; color:#fff; border:1px solid #333; border-radius:10px;">
    <input id="start" type="date" style="width:100%; margin-bottom:20px; padding:10px; background:#000; color:#fff; border:1px solid #333; border-radius:10px;">
    <button class="btn primary" id="saveBtn" style="width:100%">ğŸ’¾ Ø­ÙØ¸</button>
  </div>
</div>

<div class="modal" id="authModal" aria-hidden="true">
  <div class="box" style="width: 350px; padding: 20px;">
    <h3>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
    <input id="authEmail" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„" style="width:100%; margin-bottom:10px; padding:10px; background:#000; color:#fff; border:1px solid #333; border-radius:10px;">
    <input id="authPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="width:100%; margin-bottom:20px; padding:10px; background:#000; color:#fff; border:1px solid #333; border-radius:10px;">
    <button class="btn primary" id="authLogin" style="width:100%">Ø¯Ø®ÙˆÙ„</button>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
'use strict';
const $ = (id)=>document.getElementById(id);
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyAQPzqeazhj4rjyY1dbcGZ9YEAv8ZhLQbQ",
  authDomain: "dattta-6f497.firebaseapp.com",
  databaseURL: "https://dattta-6f497-default-rtdb.firebaseio.com",
  projectId: "dattta-6f497",
  storageBucket: "dattta-6f497.firebasestorage.app",
  messagingSenderId: "804914291938",
  appId: "1:804914291938:web:7a7d3fe8a5ebb28a306abb"
};

let data = []; let editingId = null; let currentFilter = 'all';

if(!firebase.apps.length) firebase.initializeApp(FIREBASE_CONFIG);
const db = firebase.database();
firebase.auth().onAuthStateChanged(async (u) => {
  if(u) { closeModal("authModal"); await load(); }
  else { data = []; render(); openModal("authModal"); }
});

async function load() {
  setSyncState('saving');
  try {
    const snap = await db.ref("subscriptions").once('value');
    data = snap.val() ? Object.values(snap.val()) : [];
    render(); setSyncState('ok');
  } catch(e) { setSyncState('fail'); showToast("ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + e.message, "err"); }
}

async function firebasePush() {
  setSyncState('saving');
  try {
    await db.ref("subscriptions").set(data);
    setSyncState('ok');
  } catch(e) { setSyncState('fail'); showToast("ØªØ¹Ø°Ø± Ø§Ù„Ø­ÙØ¸: " + e.message, "err"); }
}

function setSyncState(st) {
  const val = $('syncVal'); const chip = $('syncChip');
  chip.className = "statChip sync " + st;
  if(st==='saving') val.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...';
  if(st==='ok') { const d=new Date(); val.textContent = d.getHours()+':'+String(d.getMinutes()).padStart(2,'0') + ' âœ…'; }
  if(st==='fail') val.textContent = 'ÙØ´Ù„ âŒ';
}

function render() {
  const tb = $('tbody'); tb.innerHTML = '';
  const q = $('search').value.toLowerCase();
  data.filter(r => {
    const match = !q || r.name.toLowerCase().includes(q) || (r.phone||"").includes(q);
    const left = Math.round((new Date(r.end) - new Date()) / 86400000);
    const key = left < 0 ? 'expired' : 'active';
    if(currentFilter !== 'all' && currentFilter !== key) return false;
    return match;
  }).forEach(r => {
    const left = Math.round((new Date(r.end) - new Date()) / 86400000);
    const tr = document.createElement('tr');
    if(left < 0) tr.className = 'expired-row';
    tr.innerHTML = `<td>${r.name}</td><td>${r.phone||'-'}</td><td>${r.months} Ø´</td><td>${r.price} DZD</td><td>${r.end}</td><td><span style="color:${left<0?'#ef4444':'#22c55e'}">${left<0?'Ù…Ù†ØªÙ‡ÙŠ':'ÙØ¹Ø§Ù„'}</span></td><td><button class="btn" onclick="deleteRow('${r.id}')">ğŸ—‘ï¸</button></td>`;
    tb.appendChild(tr);
  });
}

$('saveBtn').onclick = async () => {
  const start = $('start').value; const months = parseInt($('months').value);
  if(!$('name').value || !start || isNaN(months)) return showToast("Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©", "err");
  const endD = new Date(start); endD.setMonth(endD.getMonth() + months);
  const rec = { id: Date.now().toString(), name: $('name').value, phone: $('phone').value, price: $('price').value, start, end: endD.toISOString().split('T')[0], months };
  data.unshift(rec);
  await firebasePush(); render(); closeModal('formModal');
};

window.deleteRow = async (id) => { if(confirm("Ø­Ø°ÙØŸ")) { data = data.filter(x => x.id !== id); await firebasePush(); render(); } };
$('authLogin').onclick = () => { firebase.auth().signInWithEmailAndPassword($('authEmail').value, $('authPass').value).catch(e => showToast(e.message, "err")); };
function openModal(id) { $(id).setAttribute('aria-hidden','false'); }
function closeModal(id) { $(id).setAttribute('aria-hidden','true'); }
function showToast(m, k="ok") { const t=$('toast'); t.textContent=m; t.style.background=k==="err"?"#ef4444":"#7c5cff"; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3000); }
$('openAdd').onclick = () => { $('start').value=new Date().toISOString().split('T')[0]; openModal('formModal'); };
$('search').oninput = render;
$('openAuth').onclick = () => openModal('authModal');
</script>
</body>
</html>
